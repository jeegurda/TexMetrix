"use strict";(()=>{var C=()=>{let e=["actualBoundingBoxAscent","actualBoundingBoxDescent","actualBoundingBoxLeft","actualBoundingBoxRight","fontBoundingBoxAscent","fontBoundingBoxDescent","emHeightAscent","emHeightDescent","alphabeticBaseline","hangingBaseline","ideographicBaseline","width"],s=[],p=[];e.forEach(o=>o in TextMetrics.prototype?s.push(o):p.push(o)),console.log("Supported: %o. Not supported: %o",s.join(", "),p.join(", "))};var E=(o=>(o.START="start",o.CENTER="center",o.END="end",o))(E||{}),M=(h=>(h.ALPHABETIC="alphabetic",h.BOTTOM="bottom",h.HANGING="hanging",h.IDEOGRAPHIC="ideographic",h.MIDDLE="middle",h.TOP="top",h))(M||{}),S=(c=>(c.w100="100",c.w200="200",c.w300="300",c.w400="400",c.w500="500",c.w600="600",c.w700="700",c.w800="800",c.w900="900",c))(S||{});var m=(e,s)=>{let p=Object.values(s);return p.includes(e)?e:(console.warn("%o does not exist in enum %o. Using %o",e,s,p[0]),p[0])},x=(e="Unknown",s=Error)=>{throw new s(e)},z=(e,s)=>`${e.font.useItalic?"italic":"normal"} ${e.font.useWeight?e.font.fw:""} ${s??e.font.size}px ${e.font.useFs?e.font.fs:e.font.ff}`,F=e=>{let s=e.reduce((o,{family:f,fullName:g,style:h,postscriptName:I})=>((o[f]||(o[f]=[])).push({fullName:g,style:h,postscriptName:I}),o),{});return(o=>{Object.entries(o).forEach(([f,g])=>{g?g.length===0&&console.warn("%o font record has no variants",f):console.warn("%o font record missing value",f)})})(s),s};var i=e=>document.querySelector(e)??x(`dom el missing (selector: ${e})`),t={mainCss:i(".main-css"),textInput:i(".text-input"),ffInput:i(".ff-input"),useFsInput:i(".use-fs-input"),fsInput:i(".fs-input"),useItalicInput:i(".use-italic-input"),useWeightInput:i(".use-weight-input"),fwInput:i(".fw-input"),localFontsButton:i(".local-fonts-button"),fontSizeInput:i(".font-size-input"),fontSizeValue:i(".font-size-value"),lhInput:i(".line-height-input"),lhValue:i(".line-height-value"),alignInput:i(".align-input"),baselineInput:i(".baseline-input"),canvas:i(".canvas canvas"),canvasUi:i(".canvas-ui"),rrValue:i(".rr-value"),dprValue:i(".dpr-value"),rrInput:i(".rr-input"),canvasSizeValue:i(".canvas-size-value"),renderPixelValue:i(".render-pixel-value"),zoomValue:i(".zoom-value"),lineStyle:{blAlign:{color:i(".bl-align-color-input"),width:i(".bl-align-width-input"),display:i(".bl-align-display-input")},fontBb:{color:i(".font-color-input"),width:i(".font-width-input"),display:i(".font-display-input")},actualBb:{color:i(".actual-color-input"),width:i(".actual-width-input"),display:i(".actual-display-input")},alphabeticBl:{display:i(".alphabetic-bl-display-input")},hangingBl:{display:i(".hanging-bl-display-input")},ideographicBl:{display:i(".ideographic-bl-display-input")}}};var H=[{postscriptName:"serif",fullName:"Browser serif",family:"serif",style:"(browser)"},{postscriptName:"sans-serif",fullName:"Browser sans-serif",family:"sans-serif",style:"(browser)"},{postscriptName:"monospace",fullName:"Browser monospace",family:"monospace",style:"(browser)"}],O=30,U=10,$=[{dProp:"alphabeticBl",mProp:"alphabeticBaseline"},{dProp:"ideographicBl",mProp:"ideographicBaseline"},{dProp:"hangingBl",mProp:"hangingBaseline"}];var v=e=>{let s=e.props.shared.ctx,p=s.canvas.clientWidth,o=s.canvas.clientHeight;e.props.rw=p/e.props.scaleMp,e.props.rh=o/e.props.scaleMp,s.canvas.width=p*e.props.rr,s.canvas.height=o*e.props.rr,s.scale(e.props.rr*e.props.scaleMp,e.props.rr*e.props.scaleMp),e.props.shared.cw=p,e.props.shared.ch=o},te=e=>{let{rw:s,rh:p,shared:{ctx:o}}=e.props,f=(d,n,a)=>{o.save(),o.textAlign=e.font.align,o.textBaseline=e.font.baseline,o.font=z(e),o.fillText(d,n,a);let l=o.measureText(d);return o.restore(),l},g=(d,n,a)=>{let l=new Path2D;l.moveTo(0,a),l.lineTo(s,a),d===0&&(l.moveTo(n,0),l.lineTo(n,p)),o.save(),o.strokeStyle=e.props.style.blAlign.color,o.lineWidth=e.props.style.blAlign.width,o.stroke(l),o.restore()},h=(d,n,a,l)=>{let r=new Path2D;r.moveTo(0,l-n.fontBoundingBoxAscent),r.lineTo(s,l-n.fontBoundingBoxAscent),r.moveTo(0,l+n.fontBoundingBoxDescent),r.lineTo(s,l+n.fontBoundingBoxDescent),o.save(),o.strokeStyle=e.props.style.fontBb.color,o.lineWidth=e.props.style.fontBb.width,o.stroke(r),o.restore()},I=(d,n,a,l)=>{let r=new Path2D;r.moveTo(0,l-n.actualBoundingBoxAscent),r.lineTo(s,l-n.actualBoundingBoxAscent),r.moveTo(0,l+n.actualBoundingBoxDescent),r.lineTo(s,l+n.actualBoundingBoxDescent),d===0&&(r.moveTo(a-n.actualBoundingBoxLeft,0),r.lineTo(a-n.actualBoundingBoxLeft,p)),r.moveTo(a+n.actualBoundingBoxRight,0),r.lineTo(a+n.actualBoundingBoxRight,p),o.save(),o.strokeStyle=e.props.style.actualBb.color,o.lineWidth=e.props.style.actualBb.width,o.stroke(r),o.restore()},w=0,c=(d,n,a,l)=>{let r=new Path2D,B=O/e.props.scaleMp,b=U/e.props.scaleMp,k=(d===0?l-n.actualBoundingBoxAscent:w)-B,P=a+n.actualBoundingBoxRight+B;r.moveTo(a-n.actualBoundingBoxLeft,k),r.lineTo(a+n.actualBoundingBoxRight,k),r.moveTo(P,l-n.actualBoundingBoxAscent),r.lineTo(P,l+n.actualBoundingBoxDescent),o.save(),o.strokeStyle=e.props.style.actualBb.color,o.lineWidth=e.props.style.actualBb.width,o.save(),o.globalAlpha=.5,o.stroke(r),o.restore(),o.textAlign="center",o.textBaseline="bottom",o.font=z(e,e.font.size/2);let Y=n.actualBoundingBoxLeft+n.actualBoundingBoxRight,Z=a-n.actualBoundingBoxLeft+Y/2,R=k-b;o.fillText(`${Y.toFixed(1)}px`,Z,R);let X=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent,_=P+b,ee=l-n.actualBoundingBoxAscent+X/2;o.save(),o.translate(_,ee),o.rotate(90/(180/Math.PI)),o.fillText(`${X.toFixed(1)}px`,0,0),o.restore(),o.textAlign="end",o.fillText(`(${n.width.toFixed(1)}px/${n.fontBoundingBoxAscent+n.fontBoundingBoxDescent}px)`,a-b,l),o.restore(),w=R-e.font.size/2},L=(d,n,a,l)=>{$.forEach(({dProp:r,mProp:B})=>{if(!e.props.style[r].display)return;let b=new Path2D;b.moveTo(0,l-(n[B]||0)),b.lineTo(s,l-(n[B]||0)),o.save(),o.strokeStyle=e.props.style.blAlign.color,o.lineWidth=e.props.style.blAlign.width,o.stroke(b),o.restore()})};o.clearRect(0,0,s,p),e.text.split(`
`).forEach((d,n)=>{let a=e.props.drawX,l=e.props.drawY+e.font.lh*n,r=f(d,a,l);o.save(),o.globalAlpha=.5,e.props.style.blAlign.display&&g(n,a,l),e.props.style.fontBb.display&&h(n,r,a,l),e.props.style.actualBb.display&&I(n,r,a,l),L(n,r,a,l),o.restore(),e.props.style.actualBb.display&&c(n,r,a,l)})},N=null,u=(...e)=>{typeof N=="number"&&cancelAnimationFrame(N),N=requestAnimationFrame(te.bind(null,...e))};var q=e=>e.map(s=>{let p=document.createElement("option");return typeof s=="string"?(p.value=s,p.innerHTML=s):(p.value=s.postscriptName,p.innerHTML=s.style,p.title=s.fullName),p}),A=e=>{t.canvasSizeValue.innerHTML=e.props.rw.toFixed(1)+"x"+e.props.rh.toFixed(1),t.renderPixelValue.innerHTML=(e.props.rw*e.props.rr).toFixed(1)+"x"+(e.props.rh*e.props.rr).toFixed(1)},y=e=>{t.textInput.style.fontFamily=e.font.useFs?e.font.fs:e.font.ff,t.textInput.style.fontStyle=e.font.useItalic?"italic":"normal",t.textInput.style.fontWeight=e.font.useWeight?e.font.fw:""},V=e=>{t.ffInput.innerHTML="",t.ffInput.append(...q(Object.keys(e.props.shared.fm))),t.ffInput.value=e.font.ff},D=(e,s=!1)=>{let p=e.props.shared.fm[e.font.ff]??x("Selected font-family is not in fontmap");t.fsInput.innerHTML="",t.fsInput.append(...q(p)),s&&(e.font.fs=p[0].postscriptName),p.map(({postscriptName:f})=>f).includes(e.font.fs)||console.warn("%o is not in available styles list. Who tf set that?",e.font.fs),t.fsInput.value=e.font.fs},j=e=>{t.textInput.value=e.text,y(e),V(e),D(e),t.useFsInput.checked=e.font.useFs,t.fsInput.disabled=!t.useFsInput.checked,t.useItalicInput.checked=e.font.useItalic,t.useWeightInput.checked=e.font.useWeight,t.fwInput.value=e.font.fw,t.fwInput.disabled=!t.useWeightInput.checked,t.fontSizeInput.value=String(e.font.size),t.fontSizeValue.innerHTML=String(e.font.size),t.lhInput.value=String(e.font.lh),t.lhValue.innerHTML=String(e.font.lh),t.alignInput.value=e.font.align,t.baselineInput.value=e.font.baseline,t.rrValue.innerHTML=String(e.props.rr),t.dprValue.innerHTML=String(window.devicePixelRatio),t.rrInput.value=String(e.props.rr),A(e),t.zoomValue.innerHTML=String(e.props.scaleMp),t.lineStyle.blAlign.color.value=e.props.style.blAlign.color,t.lineStyle.blAlign.width.value=String(e.props.style.blAlign.width),t.lineStyle.blAlign.display.checked=e.props.style.blAlign.display,t.lineStyle.fontBb.color.value=e.props.style.fontBb.color,t.lineStyle.fontBb.width.value=String(e.props.style.fontBb.width),t.lineStyle.fontBb.display.checked=e.props.style.fontBb.display,t.lineStyle.actualBb.color.value=e.props.style.actualBb.color,t.lineStyle.actualBb.width.value=String(e.props.style.actualBb.width),t.lineStyle.actualBb.display.checked=e.props.style.actualBb.display,t.lineStyle.alphabeticBl.display.disabled=!("alphabeticBaseline"in TextMetrics.prototype),t.lineStyle.hangingBl.display.disabled=!("hangingBaseline"in TextMetrics.prototype),t.lineStyle.ideographicBl.display.disabled=!("ideographicBaseline"in TextMetrics.prototype),t.lineStyle.alphabeticBl.display.checked=e.props.style.alphabeticBl.display,t.lineStyle.ideographicBl.display.checked=e.props.style.ideographicBl.display,t.lineStyle.hangingBl.display.checked=e.props.style.hangingBl.display};var G=e=>{t.textInput.addEventListener("input",()=>{e.text=t.textInput.value,u(e)}),t.ffInput.addEventListener("change",()=>{e.font.ff=t.ffInput.value,D(e,!0),y(e),u(e)}),t.useFsInput.addEventListener("change",()=>{e.font.useFs=t.useFsInput.checked,t.fsInput.disabled=!t.useFsInput.checked,y(e),u(e)}),t.fsInput.addEventListener("change",()=>{e.font.fs=t.fsInput.value,y(e),u(e)}),t.useItalicInput.addEventListener("change",()=>{e.font.useItalic=t.useItalicInput.checked,y(e),u(e)}),t.useWeightInput.addEventListener("change",()=>{e.font.useWeight=t.useWeightInput.checked,t.fwInput.disabled=!t.useWeightInput.checked,y(e),u(e)}),t.fwInput.addEventListener("change",()=>{e.font.fw=m(t.fwInput.value,S),y(e),u(e)}),t.localFontsButton.addEventListener("click",()=>{let n=a=>{e.props.shared.fm=F(H.concat(a)),V(e),D(e)};window.queryLocalFonts?window.queryLocalFonts().then(a=>{a.length===0?console.warn("Empty array, permission denied. Enable manually in browser"):n(a)}).catch(a=>{console.error("Local fonts query failed: %o",a)}):console.warn("Local fonts not supported")}),t.fontSizeInput.addEventListener("input",()=>{e.font.size=Number(t.fontSizeInput.value),t.fontSizeValue.innerHTML=t.fontSizeInput.value,u(e)}),t.lhInput.addEventListener("input",()=>{e.font.lh=Number(t.lhInput.value),t.lhValue.innerHTML=t.lhInput.value,u(e)}),t.alignInput.addEventListener("change",()=>{e.font.align=m(t.alignInput.value,E),u(e)}),t.baselineInput.addEventListener("change",()=>{e.font.baseline=m(t.baselineInput.value,M),u(e)}),t.rrInput.addEventListener("input",()=>{let n=t.rrInput.value;t.rrValue.innerHTML=n,e.props.rr=Number(n),v(e),A(e),u(e)}),window.addEventListener("resize",()=>{v(e),A(e),u(e)}),["blAlign","fontBb","actualBb"].forEach(n=>{t.lineStyle[n].color.addEventListener("input",()=>{e.props.style[n].color=t.lineStyle[n].color.value,u(e)}),t.lineStyle[n].width.addEventListener("input",()=>{e.props.style[n].width=Number(t.lineStyle[n].width.value),u(e)}),t.lineStyle[n].display.addEventListener("input",()=>{e.props.style[n].display=t.lineStyle[n].display.checked,u(e)})}),["alphabeticBl","hangingBl","ideographicBl"].forEach(n=>{t.lineStyle[n].display.addEventListener("input",()=>{e.props.style[n].display=t.lineStyle[n].display.checked,u(e)})}),t.canvasUi.addEventListener("contextmenu",n=>{n.preventDefault()});let o=0;t.canvasUi.addEventListener("wheel",n=>{if(n.preventDefault(),n.ctrlKey){o+=-n.deltaY/100;let a=Math.pow(1.4,o);e.props.scaleMp=a,t.zoomValue.innerHTML=e.props.scaleMp.toFixed(2);let l=e.props.rw*(n.offsetX/e.props.shared.cw),r=e.props.rh*(n.offsetY/e.props.shared.ch);v(e);let B=e.props.rw*(n.offsetX/e.props.shared.cw),b=e.props.rh*(n.offsetY/e.props.shared.ch);e.props.drawX+=B-l,e.props.drawY+=b-r}else{let a=n.deltaX/e.props.scaleMp,l=n.deltaY/e.props.scaleMp;e.props.drawX-=a,e.props.drawY-=l}u(e)});let f=!1,g,h,I,w,c=()=>{t.canvasUi.classList.remove("grabbing"),d()},L=n=>{if(n.buttons===0){c();return}n.preventDefault(),e.props.drawX=I+(n.clientX-g)/e.props.scaleMp,e.props.drawY=w+(n.clientY-h)/e.props.scaleMp,u(e)},W=()=>{if(f){console.warn("Events already exist");return}window.addEventListener("mousemove",L),window.addEventListener("mouseup",c),f=!0},d=()=>{window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",c),f=!1};t.canvasUi.addEventListener("mousedown",n=>{n.preventDefault(),t.canvasUi.classList.add("grabbing"),g=n.clientX,h=n.clientY,I=e.props.drawX,w=e.props.drawY,W()})};var ne=t.canvas.getContext("2d")??x("ctx died"),J=F(H),Q="sans-serif",oe=J[Q]??x("Default font family not found"),T={text:"my honest reaction \u{1F605}\u{1F44C}\u{1F3FD}",font:{fs:oe[0].postscriptName,useItalic:!1,useWeight:!1,useFs:!0,fw:"400",ff:Q,size:60,lh:80,align:"start",baseline:"alphabetic"},props:{rw:0,rh:0,drawX:0,drawY:0,scaleMp:1,rr:window.devicePixelRatio,style:{blAlign:{color:"#c800c8",width:.5,display:!0},fontBb:{color:"#f00000",width:.5,display:!0},actualBb:{color:"#000000",width:.5,display:!0},alphabeticBl:{display:!1},hangingBl:{display:!1},ideographicBl:{display:!1}},shared:{cw:0,ch:0,fm:J,ctx:ne}}},le=()=>{T.props.drawX=100,T.props.drawY=t.canvas.clientHeight-100},K=()=>{le(),v(T),u(T),G(T),j(T),C()};t.mainCss.sheet?K():t.mainCss.addEventListener("load",K);})();
//# sourceMappingURL=bundle.js.map
