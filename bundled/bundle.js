"use strict";(()=>{var X=()=>{let t=["actualBoundingBoxAscent","actualBoundingBoxDescent","actualBoundingBoxLeft","actualBoundingBoxRight","fontBoundingBoxAscent","fontBoundingBoxDescent","emHeightAscent","emHeightDescent","alphabeticBaseline","hangingBaseline","ideographicBaseline","width"],r=[],u=[];t.forEach(n=>n in TextMetrics.prototype?r.push(n):u.push(n)),console.log("Supported: %o. Not supported: %o",r.join(", "),u.join(", "))};var y=(n=>(n.START="start",n.CENTER="center",n.END="end",n))(y||{}),v=(f=>(f.ALPHABETIC="alphabetic",f.BOTTOM="bottom",f.HANGING="hanging",f.IDEOGRAPHIC="ideographic",f.MIDDLE="middle",f.TOP="top",f))(v||{});var F=(t,r)=>{let u=Object.values(r);return u.includes(t)?t:(console.warn("%o does not exist in enum %o. Using %o",t,r,u[0]),u[0])},b=(t="Unknown",r=Error)=>{throw new r(t)},H=(t,r,u,n)=>`${n?"italic":"normal"} ${u?"bold":"normal"} ${t}px ${r}`,x=t=>{let r=t.reduce((n,{family:c,fullName:g,style:f,postscriptName:h})=>((n[c]||(n[c]=[])).push({fullName:g,style:f,postscriptName:h}),n),{});return(n=>{Object.entries(n).forEach(([c,g])=>{g?g.length===0&&console.warn("%o font record has no variants",c):console.warn("%o font record missing value",c)})})(r),r};var s=t=>document.querySelector(t)??b(`dom el missing (selector: ${t})`),e={textInput:s(".text-input"),ffInput:s(".ff-input"),fsInput:s(".fs-input"),fsItalicInput:s(".fs-italic-input"),fsBoldInput:s(".fs-bold-input"),localFontsButton:s(".local-fonts-button"),fontSizeInput:s(".font-size-input"),fontSizeValue:s(".font-size-value"),lhInput:s(".line-height-input"),lhValue:s(".line-height-value"),alignInput:s(".align-input"),baselineInput:s(".baseline-input"),canvas:s(".canvas canvas"),canvasUi:s(".canvas-ui"),rrValue:s(".rr-value"),dprValue:s(".dpr-value"),rrInput:s(".rr-input"),canvasSizeValue:s(".canvas-size-value"),renderPixelValue:s(".render-pixel-value"),zoomValue:s(".zoom-value"),lineStyle:{blAlign:{color:s(".bl-align-color-input"),width:s(".bl-align-width-input"),display:s(".bl-align-display-input")},fontBb:{color:s(".font-color-input"),width:s(".font-width-input"),display:s(".font-display-input")},actualBb:{color:s(".actual-color-input"),width:s(".actual-width-input"),display:s(".actual-display-input")}}};var T=[{postscriptName:"serif",fullName:"Browser serif",family:"serif",style:"(browser)"},{postscriptName:"sans-serif",fullName:"Browser sans-serif",family:"sans-serif",style:"(browser)"},{postscriptName:"monospace",fullName:"Browser monospace",family:"monospace",style:"(browser)"}];var O=t=>t.map(r=>{let u=document.createElement("option");return typeof r=="string"?(u.value=r,u.innerHTML=r):(u.value=r.postscriptName,u.innerHTML=r.style,u.title=r.fullName),u}),L=t=>{e.canvasSizeValue.innerHTML=t.props.rw.toFixed(1)+"x"+t.props.rh.toFixed(1),e.renderPixelValue.innerHTML=(t.props.rw*t.props.rr).toFixed(1)+"x"+(t.props.rh*t.props.rr).toFixed(1)},B=t=>{e.textInput.style.fontFamily=t.font.fs,e.textInput.style.fontStyle=t.font.fsItalic?"italic":"normal",e.textInput.style.fontWeight=t.font.fsBold?"bold":"normal"},A=t=>{e.ffInput.innerHTML="",e.ffInput.append(...O(Object.keys(t.props.shared.fm))),e.ffInput.value=t.font.ff},I=(t,r=!1)=>{let u=t.props.shared.fm[t.font.ff]??b("Selected font-family is not in fontmap");e.fsInput.innerHTML="",e.fsInput.append(...O(u)),r&&(t.font.fs=u[0].postscriptName),u.map(({postscriptName:c})=>c).includes(t.font.fs)||console.warn("%o is not in available styles list. Who tf set that?",t.font.fs),e.fsInput.value=t.font.fs},C=t=>{e.textInput.value=t.text,B(t),A(t),I(t),e.fsBoldInput.checked=t.font.fsBold,e.fsItalicInput.checked=t.font.fsItalic,e.fontSizeInput.value=String(t.font.size),e.fontSizeValue.innerHTML=String(t.font.size),e.lhInput.value=String(t.font.lh),e.lhValue.innerHTML=String(t.font.lh),e.alignInput.value=t.font.align,e.baselineInput.value=t.font.baseline,e.rrValue.innerHTML=String(t.props.rr),e.dprValue.innerHTML=String(window.devicePixelRatio),e.rrInput.value=String(t.props.rr),L(t),e.zoomValue.innerHTML=String(t.props.scaleMp),e.lineStyle.blAlign.color.value=t.props.style.blAlign.color,e.lineStyle.blAlign.width.value=String(t.props.style.blAlign.width),e.lineStyle.blAlign.display.checked=t.props.style.blAlign.display,e.lineStyle.fontBb.color.value=t.props.style.fontBb.color,e.lineStyle.fontBb.width.value=String(t.props.style.fontBb.width),e.lineStyle.fontBb.display.checked=t.props.style.fontBb.display,e.lineStyle.actualBb.color.value=t.props.style.actualBb.color,e.lineStyle.actualBb.width.value=String(t.props.style.actualBb.width),e.lineStyle.actualBb.display.checked=t.props.style.actualBb.display};var U=t=>{e.textInput.addEventListener("input",()=>{t.text=e.textInput.value,t.draw()}),e.ffInput.addEventListener("change",()=>{t.font.ff=e.ffInput.value,I(t,!0),B(t),t.draw()}),e.fsInput.addEventListener("change",()=>{t.font.fs=e.fsInput.value,B(t),t.draw()}),e.fsItalicInput.addEventListener("change",()=>{t.font.fsItalic=e.fsItalicInput.checked,B(t),t.draw()}),e.fsBoldInput.addEventListener("change",()=>{t.font.fsBold=e.fsBoldInput.checked,B(t),t.draw()}),e.localFontsButton.addEventListener("click",()=>{let n=c=>{t.props.shared.fm=x(T.concat(c)),A(t),I(t)};window.queryLocalFonts?window.queryLocalFonts().then(c=>{c.length===0?console.warn("Empty array, permission denied. Enable manually in browser"):n(c)}).catch(c=>{console.error("Local fonts query failed: %o",c)}):console.warn("Local fonts not supported")}),e.fontSizeInput.addEventListener("input",()=>{t.font.size=Number(e.fontSizeInput.value),e.fontSizeValue.innerHTML=e.fontSizeInput.value,t.draw()}),e.lhInput.addEventListener("input",()=>{t.font.lh=Number(e.lhInput.value),e.lhValue.innerHTML=e.lhInput.value,t.draw()}),e.alignInput.addEventListener("change",()=>{t.font.align=F(e.alignInput.value,y),t.draw()}),e.baselineInput.addEventListener("change",()=>{t.font.baseline=F(e.baselineInput.value,v),t.draw()}),e.rrInput.addEventListener("input",()=>{let n=e.rrInput.value;e.rrValue.innerHTML=n,t.props.rr=Number(n),t.init(),L(t),t.draw()}),window.addEventListener("resize",()=>{t.init(),L(t),t.draw()}),e.canvasUi.addEventListener("contextmenu",n=>{n.preventDefault()});let r=0;e.canvasUi.addEventListener("wheel",n=>{if(n.preventDefault(),n.ctrlKey){r+=-n.deltaY/100;let c=Math.pow(1.4,r);t.props.scaleMp=c,e.zoomValue.innerHTML=t.props.scaleMp.toFixed(2);let g=t.props.rw*(n.offsetX/t.props.shared.cw),f=t.props.rh*(n.offsetY/t.props.shared.ch);t.init();let h=t.props.rw*(n.offsetX/t.props.shared.cw),w=t.props.rh*(n.offsetY/t.props.shared.ch);t.props.drawX+=h-g,t.props.drawY+=w-f}else{let c=n.deltaX/t.props.scaleMp,g=n.deltaY/t.props.scaleMp;t.props.drawX-=c,t.props.drawY-=g}t.draw()}),e.canvasUi.addEventListener("mousedown",n=>{n.preventDefault(),e.canvasUi.classList.add("grabbing");let c=n.clientX,g=n.clientY,f=t.props.drawX,h=t.props.drawY,w=l=>{l.preventDefault(),t.props.drawX=f+(l.clientX-c)/t.props.scaleMp,t.props.drawY=h+(l.clientY-g)/t.props.scaleMp,t.draw()},m=()=>{e.canvasUi.classList.remove("grabbing"),window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",m)};window.addEventListener("mousemove",w),window.addEventListener("mouseup",m)}),["blAlign","fontBb","actualBb"].forEach(n=>{e.lineStyle[n].color.addEventListener("input",()=>{t.props.style[n].color=e.lineStyle[n].color.value,t.draw()}),e.lineStyle[n].width.addEventListener("input",()=>{t.props.style[n].width=Number(e.lineStyle[n].width.value),t.draw()}),e.lineStyle[n].display.addEventListener("input",()=>{t.props.style[n].display=e.lineStyle[n].display.checked,t.draw()})})};var K=30,J=10,a=e.canvas.getContext("2d")??b("ctx died"),W=x(T),$="sans-serif",M=W[$]??b("Default font family not found"),o={text:"my honest reaction \u{1F605}\u{1F44C}\u{1F3FD}",font:{fs:M[0].postscriptName,fsItalic:!1,fsBold:!1,ff:$,size:60,lh:80,align:"start",baseline:"alphabetic"},props:{rw:0,rh:0,drawX:100,drawY:e.canvas.clientHeight-100,scaleMp:1,rr:window.devicePixelRatio,style:{blAlign:{color:"#c800c8",width:.5,display:!0},fontBb:{color:"#f00000",width:.5,display:!0},actualBb:{color:"#000000",width:.5,display:!0}},shared:{cw:0,ch:0,fm:W}},draw:()=>{},init:()=>{}},q=()=>{let t=a.canvas.clientWidth,r=a.canvas.clientHeight;o.props.rw=t/o.props.scaleMp,o.props.rh=r/o.props.scaleMp,a.canvas.width=t*o.props.rr,a.canvas.height=r*o.props.rr,a.scale(o.props.rr*o.props.scaleMp,o.props.rr*o.props.scaleMp),o.props.shared.cw=t,o.props.shared.ch=r},D=null,j=()=>{typeof D=="number"&&cancelAnimationFrame(D),D=requestAnimationFrame(Q)},Q=()=>{let{rw:t,rh:r}=o.props,u=(m,l,d)=>{a.textAlign=o.font.align,a.textBaseline=o.font.baseline,a.font=H(o.font.size,o.font.fs,o.font.fsBold,o.font.fsItalic),a.fillText(m,l,d)},n=(m,l,d)=>{let i=new Path2D;i.moveTo(0,d),i.lineTo(t,d),m===0&&(i.moveTo(l,0),i.lineTo(l,r)),a.strokeStyle=o.props.style.blAlign.color,a.lineWidth=o.props.style.blAlign.width,a.stroke(i)},c=(m,l,d,i)=>{let p=new Path2D;p.moveTo(0,i-l.fontBoundingBoxAscent),p.lineTo(t,i-l.fontBoundingBoxAscent),p.moveTo(0,i+l.fontBoundingBoxDescent),p.lineTo(t,i+l.fontBoundingBoxDescent),a.strokeStyle=o.props.style.fontBb.color,a.lineWidth=o.props.style.fontBb.width,a.stroke(p)},g=(m,l,d,i)=>{let p=new Path2D;p.moveTo(0,i-l.actualBoundingBoxAscent),p.lineTo(t,i-l.actualBoundingBoxAscent),p.moveTo(0,i+l.actualBoundingBoxDescent),p.lineTo(t,i+l.actualBoundingBoxDescent),m===0&&(p.moveTo(d-l.actualBoundingBoxLeft,0),p.lineTo(d-l.actualBoundingBoxLeft,r)),p.moveTo(d+l.actualBoundingBoxRight,0),p.lineTo(d+l.actualBoundingBoxRight,r),a.strokeStyle=o.props.style.actualBb.color,a.lineWidth=o.props.style.actualBb.width,a.stroke(p)},f=0,h=(m,l,d,i)=>{let p=new Path2D,z=K/o.props.scaleMp,k=J/o.props.scaleMp,E=(m===0?i-l.actualBoundingBoxAscent:f)-z,S=d+l.actualBoundingBoxRight+z;p.moveTo(d-l.actualBoundingBoxLeft,E),p.lineTo(d+l.actualBoundingBoxRight,E),p.moveTo(S,i-l.actualBoundingBoxAscent),p.lineTo(S,i+l.actualBoundingBoxDescent),a.globalAlpha=.5,a.strokeStyle=o.props.style.actualBb.color,a.lineWidth=o.props.style.actualBb.width,a.stroke(p),a.globalAlpha=1,a.textAlign="center",a.textBaseline="bottom",a.font=H(o.font.size/2,o.font.fs,o.font.fsBold,o.font.fsItalic);let N=l.actualBoundingBoxLeft+l.actualBoundingBoxRight,G=d-l.actualBoundingBoxLeft+N/2,P=E-k;a.fillText(`${N.toFixed(1)}px`,G,P);let V=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent,R=S+k,Y=i-l.actualBoundingBoxAscent+V/2;a.translate(R,Y),a.rotate(90/(180/Math.PI)),a.fillText(`${V.toFixed(1)}px`,0,0),a.rotate(-90/(180/Math.PI)),a.translate(-R,-Y),f=P-o.font.size/2};a.clearRect(0,0,t,r),o.text.split(`
`).forEach((m,l)=>{let d=o.props.drawX,i=o.props.drawY+o.font.lh*l;u(m,d,i),a.globalAlpha=.5;let p=a.measureText(m);o.props.style.blAlign.display&&n(l,d,i),o.props.style.fontBb.display&&c(l,p,d,i),o.props.style.actualBb.display&&g(l,p,d,i),a.globalAlpha=1,o.props.style.actualBb.display&&h(l,p,d,i)})};o.draw=j;o.init=q;U(o);q();j();C(o);X();})();
//# sourceMappingURL=bundle.js.map
