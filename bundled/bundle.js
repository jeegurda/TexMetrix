"use strict";(()=>{var C=()=>{let t=["actualBoundingBoxAscent","actualBoundingBoxDescent","actualBoundingBoxLeft","actualBoundingBoxRight","fontBoundingBoxAscent","fontBoundingBoxDescent","emHeightAscent","emHeightDescent","alphabeticBaseline","hangingBaseline","ideographicBaseline","width"],o=[],a=[];t.forEach(e=>e in TextMetrics.prototype?o.push(e):a.push(e)),console.log("Supported: %o. Not supported: %o",o.join(", "),a.join(", "))};var v=(e=>(e.START="start",e.CENTER="center",e.END="end",e))(v||{}),T=(f=>(f.ALPHABETIC="alphabetic",f.BOTTOM="bottom",f.HANGING="hanging",f.IDEOGRAPHIC="ideographic",f.MIDDLE="middle",f.TOP="top",f))(T||{});var A=(t,o)=>{let a=Object.values(o);return a.includes(t)?t:(console.warn("%o does not exist in enum %o. Using %o",t,o,a[0]),a[0])},B=(t="Unknown",o=Error)=>{throw new o(t)},D=(t,o,a,e)=>`${e?"italic":"normal"} ${a?"bold":"normal"} ${t}px ${o}`,L=t=>{let o=t.reduce((e,{family:p,fullName:d,style:f,postscriptName:b})=>((e[p]||(e[p]=[])).push({fullName:d,style:f,postscriptName:b}),e),{});return(e=>{Object.entries(e).forEach(([p,d])=>{d?d.length===0&&console.warn("%o font record has no variants",p):console.warn("%o font record missing value",p)})})(o),o};var r=t=>document.querySelector(t)??B(`dom el missing (selector: ${t})`),n={textInput:r(".text-input"),ffInput:r(".ff-input"),fsInput:r(".fs-input"),fsItalicInput:r(".fs-italic-input"),fsBoldInput:r(".fs-bold-input"),localFontsButton:r(".local-fonts-button"),fontSizeInput:r(".font-size-input"),fontSizeValue:r(".font-size-value"),lhInput:r(".line-height-input"),lhValue:r(".line-height-value"),alignInput:r(".align-input"),baselineInput:r(".baseline-input"),canvas:r(".canvas canvas"),canvasUi:r(".canvas-ui"),rrValue:r(".rr-value"),dprValue:r(".dpr-value"),rrInput:r(".rr-input"),canvasSizeValue:r(".canvas-size-value"),renderPixelValue:r(".render-pixel-value"),zoomValue:r(".zoom-value"),lineStyle:{blAlign:{color:r(".bl-align-color-input"),width:r(".bl-align-width-input"),display:r(".bl-align-display-input")},fontBb:{color:r(".font-color-input"),width:r(".font-width-input"),display:r(".font-display-input")},actualBb:{color:r(".actual-color-input"),width:r(".actual-width-input"),display:r(".actual-display-input")}}};var m=[{postscriptName:"serif",fullName:"Browser serif",family:"serif",style:"(browser)"},{postscriptName:"sans-serif",fullName:"Browser sans-serif",family:"sans-serif",style:"(browser)"},{postscriptName:"monospace",fullName:"Browser monospace",family:"monospace",style:"(browser)"}],U=30,W=10;var y=t=>{let o=t.props.shared.ctx,a=o.canvas.clientWidth,e=o.canvas.clientHeight;t.props.rw=a/t.props.scaleMp,t.props.rh=e/t.props.scaleMp,o.canvas.width=a*t.props.rr,o.canvas.height=e*t.props.rr,o.scale(t.props.rr*t.props.scaleMp,t.props.rr*t.props.scaleMp),t.props.shared.cw=a,t.props.shared.ch=e},Q=t=>{let{rw:o,rh:a,shared:{ctx:e}}=t.props,p=(g,l,c)=>{e.textAlign=t.font.align,e.textBaseline=t.font.baseline,e.font=D(t.font.size,t.font.fs,t.font.fsBold,t.font.fsItalic),e.fillText(g,l,c)},d=(g,l,c)=>{let s=new Path2D;s.moveTo(0,c),s.lineTo(o,c),g===0&&(s.moveTo(l,0),s.lineTo(l,a)),e.strokeStyle=t.props.style.blAlign.color,e.lineWidth=t.props.style.blAlign.width,e.stroke(s)},f=(g,l,c,s)=>{let i=new Path2D;i.moveTo(0,s-l.fontBoundingBoxAscent),i.lineTo(o,s-l.fontBoundingBoxAscent),i.moveTo(0,s+l.fontBoundingBoxDescent),i.lineTo(o,s+l.fontBoundingBoxDescent),e.strokeStyle=t.props.style.fontBb.color,e.lineWidth=t.props.style.fontBb.width,e.stroke(i)},b=(g,l,c,s)=>{let i=new Path2D;i.moveTo(0,s-l.actualBoundingBoxAscent),i.lineTo(o,s-l.actualBoundingBoxAscent),i.moveTo(0,s+l.actualBoundingBoxDescent),i.lineTo(o,s+l.actualBoundingBoxDescent),g===0&&(i.moveTo(c-l.actualBoundingBoxLeft,0),i.lineTo(c-l.actualBoundingBoxLeft,a)),i.moveTo(c+l.actualBoundingBoxRight,0),i.lineTo(c+l.actualBoundingBoxRight,a),e.strokeStyle=t.props.style.actualBb.color,e.lineWidth=t.props.style.actualBb.width,e.stroke(i)},h=0,w=(g,l,c,s)=>{let i=new Path2D,N=U/t.props.scaleMp,P=W/t.props.scaleMp,F=(g===0?s-l.actualBoundingBoxAscent:h)-N,H=c+l.actualBoundingBoxRight+N;i.moveTo(c-l.actualBoundingBoxLeft,F),i.lineTo(c+l.actualBoundingBoxRight,F),i.moveTo(H,s-l.actualBoundingBoxAscent),i.lineTo(H,s+l.actualBoundingBoxDescent),e.globalAlpha=.5,e.strokeStyle=t.props.style.actualBb.color,e.lineWidth=t.props.style.actualBb.width,e.stroke(i),e.globalAlpha=1,e.textAlign="center",e.textBaseline="bottom",e.font=D(t.font.size/2,t.font.fs,t.font.fsBold,t.font.fsItalic);let V=l.actualBoundingBoxLeft+l.actualBoundingBoxRight,J=c-l.actualBoundingBoxLeft+V/2,Y=F-P;e.fillText(`${V.toFixed(1)}px`,J,Y);let R=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent,X=H+P,O=s-l.actualBoundingBoxAscent+R/2;e.translate(X,O),e.rotate(90/(180/Math.PI)),e.fillText(`${R.toFixed(1)}px`,0,0),e.rotate(-90/(180/Math.PI)),e.translate(-X,-O),h=Y-t.font.size/2};e.clearRect(0,0,o,a),t.text.split(`
`).forEach((g,l)=>{let c=t.props.drawX,s=t.props.drawY+t.font.lh*l;p(g,c,s),e.globalAlpha=.5;let i=e.measureText(g);t.props.style.blAlign.display&&d(l,c,s),t.props.style.fontBb.display&&f(l,i,c,s),t.props.style.actualBb.display&&b(l,i,c,s),e.globalAlpha=1,t.props.style.actualBb.display&&w(l,i,c,s)})},z=null,u=(...t)=>{typeof z=="number"&&cancelAnimationFrame(z),z=requestAnimationFrame(Q.bind(null,...t))};var $=t=>t.map(o=>{let a=document.createElement("option");return typeof o=="string"?(a.value=o,a.innerHTML=o):(a.value=o.postscriptName,a.innerHTML=o.style,a.title=o.fullName),a}),M=t=>{n.canvasSizeValue.innerHTML=t.props.rw.toFixed(1)+"x"+t.props.rh.toFixed(1),n.renderPixelValue.innerHTML=(t.props.rw*t.props.rr).toFixed(1)+"x"+(t.props.rh*t.props.rr).toFixed(1)},x=t=>{n.textInput.style.fontFamily=t.font.fs,n.textInput.style.fontStyle=t.font.fsItalic?"italic":"normal",n.textInput.style.fontWeight=t.font.fsBold?"bold":"normal"},k=t=>{n.ffInput.innerHTML="",n.ffInput.append(...$(Object.keys(t.props.shared.fm))),n.ffInput.value=t.font.ff},E=(t,o=!1)=>{let a=t.props.shared.fm[t.font.ff]??B("Selected font-family is not in fontmap");n.fsInput.innerHTML="",n.fsInput.append(...$(a)),o&&(t.font.fs=a[0].postscriptName),a.map(({postscriptName:p})=>p).includes(t.font.fs)||console.warn("%o is not in available styles list. Who tf set that?",t.font.fs),n.fsInput.value=t.font.fs},q=t=>{n.textInput.value=t.text,x(t),k(t),E(t),n.fsBoldInput.checked=t.font.fsBold,n.fsItalicInput.checked=t.font.fsItalic,n.fontSizeInput.value=String(t.font.size),n.fontSizeValue.innerHTML=String(t.font.size),n.lhInput.value=String(t.font.lh),n.lhValue.innerHTML=String(t.font.lh),n.alignInput.value=t.font.align,n.baselineInput.value=t.font.baseline,n.rrValue.innerHTML=String(t.props.rr),n.dprValue.innerHTML=String(window.devicePixelRatio),n.rrInput.value=String(t.props.rr),M(t),n.zoomValue.innerHTML=String(t.props.scaleMp),n.lineStyle.blAlign.color.value=t.props.style.blAlign.color,n.lineStyle.blAlign.width.value=String(t.props.style.blAlign.width),n.lineStyle.blAlign.display.checked=t.props.style.blAlign.display,n.lineStyle.fontBb.color.value=t.props.style.fontBb.color,n.lineStyle.fontBb.width.value=String(t.props.style.fontBb.width),n.lineStyle.fontBb.display.checked=t.props.style.fontBb.display,n.lineStyle.actualBb.color.value=t.props.style.actualBb.color,n.lineStyle.actualBb.width.value=String(t.props.style.actualBb.width),n.lineStyle.actualBb.display.checked=t.props.style.actualBb.display};var j=t=>{n.textInput.addEventListener("input",()=>{t.text=n.textInput.value,u(t)}),n.ffInput.addEventListener("change",()=>{t.font.ff=n.ffInput.value,E(t,!0),x(t),u(t)}),n.fsInput.addEventListener("change",()=>{t.font.fs=n.fsInput.value,x(t),u(t)}),n.fsItalicInput.addEventListener("change",()=>{t.font.fsItalic=n.fsItalicInput.checked,x(t),u(t)}),n.fsBoldInput.addEventListener("change",()=>{t.font.fsBold=n.fsBoldInput.checked,x(t),u(t)}),n.localFontsButton.addEventListener("click",()=>{let e=p=>{t.props.shared.fm=L(m.concat(p)),k(t),E(t)};window.queryLocalFonts?window.queryLocalFonts().then(p=>{p.length===0?console.warn("Empty array, permission denied. Enable manually in browser"):e(p)}).catch(p=>{console.error("Local fonts query failed: %o",p)}):console.warn("Local fonts not supported")}),n.fontSizeInput.addEventListener("input",()=>{t.font.size=Number(n.fontSizeInput.value),n.fontSizeValue.innerHTML=n.fontSizeInput.value,u(t)}),n.lhInput.addEventListener("input",()=>{t.font.lh=Number(n.lhInput.value),n.lhValue.innerHTML=n.lhInput.value,u(t)}),n.alignInput.addEventListener("change",()=>{t.font.align=A(n.alignInput.value,v),u(t)}),n.baselineInput.addEventListener("change",()=>{t.font.baseline=A(n.baselineInput.value,T),u(t)}),n.rrInput.addEventListener("input",()=>{let e=n.rrInput.value;n.rrValue.innerHTML=e,t.props.rr=Number(e),y(t),M(t),u(t)}),window.addEventListener("resize",()=>{y(t),M(t),u(t)}),n.canvasUi.addEventListener("contextmenu",e=>{e.preventDefault()});let o=0;n.canvasUi.addEventListener("wheel",e=>{if(e.preventDefault(),e.ctrlKey){o+=-e.deltaY/100;let p=Math.pow(1.4,o);t.props.scaleMp=p,n.zoomValue.innerHTML=t.props.scaleMp.toFixed(2);let d=t.props.rw*(e.offsetX/t.props.shared.cw),f=t.props.rh*(e.offsetY/t.props.shared.ch);y(t);let b=t.props.rw*(e.offsetX/t.props.shared.cw),h=t.props.rh*(e.offsetY/t.props.shared.ch);t.props.drawX+=b-d,t.props.drawY+=h-f}else{let p=e.deltaX/t.props.scaleMp,d=e.deltaY/t.props.scaleMp;t.props.drawX-=p,t.props.drawY-=d}u(t)}),n.canvasUi.addEventListener("mousedown",e=>{e.preventDefault(),n.canvasUi.classList.add("grabbing");let p=e.clientX,d=e.clientY,f=t.props.drawX,b=t.props.drawY,h=I=>{I.preventDefault(),t.props.drawX=f+(I.clientX-p)/t.props.scaleMp,t.props.drawY=b+(I.clientY-d)/t.props.scaleMp,u(t)},w=()=>{n.canvasUi.classList.remove("grabbing"),window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",w)};window.addEventListener("mousemove",h),window.addEventListener("mouseup",w)}),["blAlign","fontBb","actualBb"].forEach(e=>{n.lineStyle[e].color.addEventListener("input",()=>{t.props.style[e].color=n.lineStyle[e].color.value,u(t)}),n.lineStyle[e].width.addEventListener("input",()=>{t.props.style[e].width=Number(n.lineStyle[e].width.value),u(t)}),n.lineStyle[e].display.addEventListener("input",()=>{t.props.style[e].display=n.lineStyle[e].display.checked,u(t)})})};var Z=n.canvas.getContext("2d")??B("ctx died"),G=L(m),K="sans-serif",_=G[K]??B("Default font family not found"),S={text:"my honest reaction \u{1F605}\u{1F44C}\u{1F3FD}",font:{fs:_[0].postscriptName,fsItalic:!1,fsBold:!1,ff:K,size:60,lh:80,align:"start",baseline:"alphabetic"},props:{rw:0,rh:0,drawX:100,drawY:n.canvas.clientHeight-100,scaleMp:1,rr:window.devicePixelRatio,style:{blAlign:{color:"#c800c8",width:.5,display:!0},fontBb:{color:"#f00000",width:.5,display:!0},actualBb:{color:"#000000",width:.5,display:!0}},shared:{cw:0,ch:0,fm:G,ctx:Z}}};y(S);u(S);j(S);q(S);C();})();
//# sourceMappingURL=bundle.js.map
