"use strict";(()=>{var O=()=>{let t=["actualBoundingBoxAscent","actualBoundingBoxDescent","actualBoundingBoxLeft","actualBoundingBoxRight","fontBoundingBoxAscent","fontBoundingBoxDescent","emHeightAscent","emHeightDescent","alphabeticBaseline","hangingBaseline","ideographicBaseline","width"],r=[],s=[];t.forEach(o=>o in TextMetrics.prototype?r.push(o):s.push(o)),console.log("Supported: %o. Not supported: %o",r.join(", "),s.join(", "))};var T=(o=>(o.START="start",o.CENTER="center",o.END="end",o))(T||{}),L=(f=>(f.ALPHABETIC="alphabetic",f.BOTTOM="bottom",f.HANGING="hanging",f.IDEOGRAPHIC="ideographic",f.MIDDLE="middle",f.TOP="top",f))(L||{}),m=(c=>(c.w100="100",c.w200="200",c.w300="300",c.w400="400",c.w500="500",c.w600="600",c.w700="700",c.w800="800",c.w900="900",c))(m||{});var E=(t,r)=>{let s=Object.values(r);return s.includes(t)?t:(console.warn("%o does not exist in enum %o. Using %o",t,r,s[0]),s[0])},w=(t="Unknown",r=Error)=>{throw new r(t)},N=(t,r,s,o)=>`${o?"italic":"normal"} ${s} ${t}px ${r}`,M=t=>{let r=t.reduce((o,{family:g,fullName:h,style:f,postscriptName:x})=>((o[g]||(o[g]=[])).push({fullName:h,style:f,postscriptName:x}),o),{});return(o=>{Object.entries(o).forEach(([g,h])=>{h?h.length===0&&console.warn("%o font record has no variants",g):console.warn("%o font record missing value",g)})})(r),r};var i=t=>document.querySelector(t)??w(`dom el missing (selector: ${t})`),n={textInput:i(".text-input"),ffInput:i(".ff-input"),fsInput:i(".fs-input"),fsItalicInput:i(".fs-italic-input"),fwInput:i(".fw-input"),localFontsButton:i(".local-fonts-button"),fontSizeInput:i(".font-size-input"),fontSizeValue:i(".font-size-value"),lhInput:i(".line-height-input"),lhValue:i(".line-height-value"),alignInput:i(".align-input"),baselineInput:i(".baseline-input"),canvas:i(".canvas canvas"),canvasUi:i(".canvas-ui"),rrValue:i(".rr-value"),dprValue:i(".dpr-value"),rrInput:i(".rr-input"),canvasSizeValue:i(".canvas-size-value"),renderPixelValue:i(".render-pixel-value"),zoomValue:i(".zoom-value"),lineStyle:{blAlign:{color:i(".bl-align-color-input"),width:i(".bl-align-width-input"),display:i(".bl-align-display-input")},fontBb:{color:i(".font-color-input"),width:i(".font-width-input"),display:i(".font-display-input")},actualBb:{color:i(".actual-color-input"),width:i(".actual-width-input"),display:i(".actual-display-input")}}};var S=[{postscriptName:"serif",fullName:"Browser serif",family:"serif",style:"(browser)"},{postscriptName:"sans-serif",fullName:"Browser sans-serif",family:"sans-serif",style:"(browser)"},{postscriptName:"monospace",fullName:"Browser monospace",family:"monospace",style:"(browser)"}],C=30,U=10;var v=t=>{let r=t.props.shared.ctx,s=r.canvas.clientWidth,o=r.canvas.clientHeight;t.props.rw=s/t.props.scaleMp,t.props.rh=o/t.props.scaleMp,r.canvas.width=s*t.props.rr,r.canvas.height=o*t.props.rr,r.scale(t.props.rr*t.props.scaleMp,t.props.rr*t.props.scaleMp),t.props.shared.cw=s,t.props.shared.ch=o},Z=t=>{let{rw:r,rh:s,shared:{ctx:o}}=t.props,g=(d,e,a)=>{o.save(),o.textAlign=t.font.align,o.textBaseline=t.font.baseline,o.font=N(t.font.size,t.font.fs,t.font.fw,t.font.fsItalic),o.fillText(d,e,a);let l=o.measureText(d);return o.restore(),l},h=(d,e,a)=>{let l=new Path2D;l.moveTo(0,a),l.lineTo(r,a),d===0&&(l.moveTo(e,0),l.lineTo(e,s)),o.save(),o.strokeStyle=t.props.style.blAlign.color,o.lineWidth=t.props.style.blAlign.width,o.stroke(l),o.restore()},f=(d,e,a,l)=>{let p=new Path2D;p.moveTo(0,l-e.fontBoundingBoxAscent),p.lineTo(r,l-e.fontBoundingBoxAscent),p.moveTo(0,l+e.fontBoundingBoxDescent),p.lineTo(r,l+e.fontBoundingBoxDescent),o.save(),o.strokeStyle=t.props.style.fontBb.color,o.lineWidth=t.props.style.fontBb.width,o.stroke(p),o.restore()},x=(d,e,a,l)=>{let p=new Path2D;p.moveTo(0,l-e.actualBoundingBoxAscent),p.lineTo(r,l-e.actualBoundingBoxAscent),p.moveTo(0,l+e.actualBoundingBoxDescent),p.lineTo(r,l+e.actualBoundingBoxDescent),d===0&&(p.moveTo(a-e.actualBoundingBoxLeft,0),p.lineTo(a-e.actualBoundingBoxLeft,s)),p.moveTo(a+e.actualBoundingBoxRight,0),p.lineTo(a+e.actualBoundingBoxRight,s),o.save(),o.strokeStyle=t.props.style.actualBb.color,o.lineWidth=t.props.style.actualBb.width,o.stroke(p),o.restore()},b=0,c=(d,e,a,l)=>{let p=new Path2D,I=C/t.props.scaleMp,y=U/t.props.scaleMp,D=(d===0?l-e.actualBoundingBoxAscent:b)-I,z=a+e.actualBoundingBoxRight+I;p.moveTo(a-e.actualBoundingBoxLeft,D),p.lineTo(a+e.actualBoundingBoxRight,D),p.moveTo(z,l-e.actualBoundingBoxAscent),p.lineTo(z,l+e.actualBoundingBoxDescent),o.save(),o.strokeStyle=t.props.style.actualBb.color,o.lineWidth=t.props.style.actualBb.width,o.save(),o.globalAlpha=.5,o.stroke(p),o.restore(),o.textAlign="center",o.textBaseline="bottom",o.font=N(t.font.size/2,t.font.fs,t.font.fw,t.font.fsItalic);let Y=e.actualBoundingBoxLeft+e.actualBoundingBoxRight,K=a-e.actualBoundingBoxLeft+Y/2,R=D-y;o.fillText(`${Y.toFixed(1)}px`,K,R);let X=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent,J=z+y,Q=l-e.actualBoundingBoxAscent+X/2;o.save(),o.translate(J,Q),o.rotate(90/(180/Math.PI)),o.fillText(`${X.toFixed(1)}px`,0,0),o.restore(),o.textAlign="end",o.fillText(`(${e.width.toFixed(1)}px/${e.fontBoundingBoxAscent+e.fontBoundingBoxDescent}px)`,a-y,l),o.restore(),b=R-t.font.size/2};o.clearRect(0,0,r,s),t.text.split(`
`).forEach((d,e)=>{let a=t.props.drawX,l=t.props.drawY+t.font.lh*e,p=g(d,a,l);o.save(),o.globalAlpha=.5,t.props.style.blAlign.display&&h(e,a,l),t.props.style.fontBb.display&&f(e,p,a,l),t.props.style.actualBb.display&&x(e,p,a,l),o.restore(),t.props.style.actualBb.display&&c(e,p,a,l)})},k=null,u=(...t)=>{typeof k=="number"&&cancelAnimationFrame(k),k=requestAnimationFrame(Z.bind(null,...t))};var $=t=>t.map(r=>{let s=document.createElement("option");return typeof r=="string"?(s.value=r,s.innerHTML=r):(s.value=r.postscriptName,s.innerHTML=r.style,s.title=r.fullName),s}),F=t=>{n.canvasSizeValue.innerHTML=t.props.rw.toFixed(1)+"x"+t.props.rh.toFixed(1),n.renderPixelValue.innerHTML=(t.props.rw*t.props.rr).toFixed(1)+"x"+(t.props.rh*t.props.rr).toFixed(1)},B=t=>{n.textInput.style.fontFamily=t.font.fs,n.textInput.style.fontStyle=t.font.fsItalic?"italic":"normal",n.textInput.style.fontWeight=t.font.fw},P=t=>{n.ffInput.innerHTML="",n.ffInput.append(...$(Object.keys(t.props.shared.fm))),n.ffInput.value=t.font.ff},H=(t,r=!1)=>{let s=t.props.shared.fm[t.font.ff]??w("Selected font-family is not in fontmap");n.fsInput.innerHTML="",n.fsInput.append(...$(s)),r&&(t.font.fs=s[0].postscriptName),s.map(({postscriptName:g})=>g).includes(t.font.fs)||console.warn("%o is not in available styles list. Who tf set that?",t.font.fs),n.fsInput.value=t.font.fs},W=t=>{n.textInput.value=t.text,B(t),P(t),H(t),n.fwInput.value=t.font.fw,n.fsItalicInput.checked=t.font.fsItalic,n.fontSizeInput.value=String(t.font.size),n.fontSizeValue.innerHTML=String(t.font.size),n.lhInput.value=String(t.font.lh),n.lhValue.innerHTML=String(t.font.lh),n.alignInput.value=t.font.align,n.baselineInput.value=t.font.baseline,n.rrValue.innerHTML=String(t.props.rr),n.dprValue.innerHTML=String(window.devicePixelRatio),n.rrInput.value=String(t.props.rr),F(t),n.zoomValue.innerHTML=String(t.props.scaleMp),n.lineStyle.blAlign.color.value=t.props.style.blAlign.color,n.lineStyle.blAlign.width.value=String(t.props.style.blAlign.width),n.lineStyle.blAlign.display.checked=t.props.style.blAlign.display,n.lineStyle.fontBb.color.value=t.props.style.fontBb.color,n.lineStyle.fontBb.width.value=String(t.props.style.fontBb.width),n.lineStyle.fontBb.display.checked=t.props.style.fontBb.display,n.lineStyle.actualBb.color.value=t.props.style.actualBb.color,n.lineStyle.actualBb.width.value=String(t.props.style.actualBb.width),n.lineStyle.actualBb.display.checked=t.props.style.actualBb.display};var q=t=>{n.textInput.addEventListener("input",()=>{t.text=n.textInput.value,u(t)}),n.ffInput.addEventListener("change",()=>{t.font.ff=n.ffInput.value,H(t,!0),B(t),u(t)}),n.fsInput.addEventListener("change",()=>{t.font.fs=n.fsInput.value,B(t),u(t)}),n.fsItalicInput.addEventListener("change",()=>{t.font.fsItalic=n.fsItalicInput.checked,B(t),u(t)}),n.fwInput.addEventListener("change",()=>{t.font.fw=E(n.fwInput.value,m),B(t),u(t)}),n.localFontsButton.addEventListener("click",()=>{let e=a=>{t.props.shared.fm=M(S.concat(a)),P(t),H(t)};window.queryLocalFonts?window.queryLocalFonts().then(a=>{a.length===0?console.warn("Empty array, permission denied. Enable manually in browser"):e(a)}).catch(a=>{console.error("Local fonts query failed: %o",a)}):console.warn("Local fonts not supported")}),n.fontSizeInput.addEventListener("input",()=>{t.font.size=Number(n.fontSizeInput.value),n.fontSizeValue.innerHTML=n.fontSizeInput.value,u(t)}),n.lhInput.addEventListener("input",()=>{t.font.lh=Number(n.lhInput.value),n.lhValue.innerHTML=n.lhInput.value,u(t)}),n.alignInput.addEventListener("change",()=>{t.font.align=E(n.alignInput.value,T),u(t)}),n.baselineInput.addEventListener("change",()=>{t.font.baseline=E(n.baselineInput.value,L),u(t)}),n.rrInput.addEventListener("input",()=>{let e=n.rrInput.value;n.rrValue.innerHTML=e,t.props.rr=Number(e),v(t),F(t),u(t)}),window.addEventListener("resize",()=>{v(t),F(t),u(t)}),["blAlign","fontBb","actualBb"].forEach(e=>{n.lineStyle[e].color.addEventListener("input",()=>{t.props.style[e].color=n.lineStyle[e].color.value,u(t)}),n.lineStyle[e].width.addEventListener("input",()=>{t.props.style[e].width=Number(n.lineStyle[e].width.value),u(t)}),n.lineStyle[e].display.addEventListener("input",()=>{t.props.style[e].display=n.lineStyle[e].display.checked,u(t)})}),n.canvasUi.addEventListener("contextmenu",e=>{e.preventDefault()});let s=0;n.canvasUi.addEventListener("wheel",e=>{if(e.preventDefault(),e.ctrlKey){s+=-e.deltaY/100;let a=Math.pow(1.4,s);t.props.scaleMp=a,n.zoomValue.innerHTML=t.props.scaleMp.toFixed(2);let l=t.props.rw*(e.offsetX/t.props.shared.cw),p=t.props.rh*(e.offsetY/t.props.shared.ch);v(t);let I=t.props.rw*(e.offsetX/t.props.shared.cw),y=t.props.rh*(e.offsetY/t.props.shared.ch);t.props.drawX+=I-l,t.props.drawY+=y-p}else{let a=e.deltaX/t.props.scaleMp,l=e.deltaY/t.props.scaleMp;t.props.drawX-=a,t.props.drawY-=l}u(t)});let o=!1,g,h,f,x,b=()=>{n.canvasUi.classList.remove("grabbing"),d()},c=e=>{if(e.buttons===0){b();return}e.preventDefault(),t.props.drawX=f+(e.clientX-g)/t.props.scaleMp,t.props.drawY=x+(e.clientY-h)/t.props.scaleMp,u(t)},V=()=>{if(o){console.warn("Events already exist");return}window.addEventListener("mousemove",c),window.addEventListener("mouseup",b),o=!0},d=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",b),o=!1};n.canvasUi.addEventListener("mousedown",e=>{e.preventDefault(),n.canvasUi.classList.add("grabbing"),g=e.clientX,h=e.clientY,f=t.props.drawX,x=t.props.drawY,V()})};var _=n.canvas.getContext("2d")??w("ctx died"),j=M(S),G="sans-serif",tt=j[G]??w("Default font family not found"),A={text:"my honest reaction \u{1F605}\u{1F44C}\u{1F3FD}",font:{fs:tt[0].postscriptName,fsItalic:!1,fw:"100",ff:G,size:60,lh:80,align:"start",baseline:"alphabetic"},props:{rw:0,rh:0,drawX:100,drawY:n.canvas.clientHeight-100,scaleMp:1,rr:window.devicePixelRatio,style:{blAlign:{color:"#c800c8",width:.5,display:!0},fontBb:{color:"#f00000",width:.5,display:!0},actualBb:{color:"#000000",width:.5,display:!0}},shared:{cw:0,ch:0,fm:j,ctx:_}}};v(A);u(A);q(A);W(A);O();})();
//# sourceMappingURL=bundle.js.map
