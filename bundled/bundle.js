"use strict";(()=>{var U=()=>{let e=["actualBoundingBoxAscent","actualBoundingBoxDescent","actualBoundingBoxLeft","actualBoundingBoxRight","fontBoundingBoxAscent","fontBoundingBoxDescent","emHeightAscent","emHeightDescent","alphabeticBaseline","hangingBaseline","ideographicBaseline","width"],o=[],r=[];e.forEach(n=>n in TextMetrics.prototype?o.push(n):r.push(n)),console.log("Supported: %o. Not supported: %o",o.join(", "),r.join(", "))};var E=(n=>(n.START="start",n.CENTER="center",n.END="end",n))(E||{}),m=(s=>(s.ALPHABETIC="alphabetic",s.BOTTOM="bottom",s.HANGING="hanging",s.IDEOGRAPHIC="ideographic",s.MIDDLE="middle",s.TOP="top",s))(m||{}),S=(h=>(h.w100="100",h.w200="200",h.w300="300",h.w400="400",h.w500="500",h.w600="600",h.w700="700",h.w800="800",h.w900="900",h))(S||{});var H=(e,o)=>{let r=Object.values(o);return r.includes(e)?e:(console.warn("%o does not exist in enum %o. Using %o",e,o,r[0]),r[0])},x=(e="Unknown",o=Error)=>{throw new o(e)},W=(e,o)=>`${e.font.useItalic?"italic":"normal"} ${e.font.useWeight?e.font.fw:""} ${o??e.font.size}px ${e.font.useFs?e.font.fs:e.font.ff}`,F=e=>{let o=e.reduce((n,{family:g,fullName:b,style:s,postscriptName:f})=>((n[g]||(n[g]=[])).push({fullName:b,style:s,postscriptName:f}),n),{});return(n=>{Object.entries(n).forEach(([g,b])=>{b?b.length===0&&console.warn("%o font record has no variants",g):console.warn("%o font record missing value",g)})})(o),o},C=e=>{let o=getComputedStyle(t.document).getPropertyValue(e);return o===""&&console.warn(`CSS var "${e}" not set`),o};var a=e=>document.querySelector(e)??x(`dom el missing (selector: ${e})`),se=e=>{let o=document.querySelectorAll(e);return o.length?Array.from(o):x(`dom els missing (all selector: ${e})`)},t={document:document.documentElement,mainCss:a(".main-css"),textInput:a(".text-input"),ffInput:a(".ff-input"),useFsInput:a(".use-fs-input"),fsInput:a(".fs-input"),useItalicInput:a(".use-italic-input"),useWeightInput:a(".use-weight-input"),fwInput:a(".fw-input"),localFontsButton:a(".local-fonts-button"),fontSizeInput:a(".font-size-input"),fontSizeValue:a(".font-size-value"),lhInput:a(".line-height-input"),lhValue:a(".line-height-value"),alignInput:a(".align-input"),baselineInput:a(".baseline-input"),canvas:a(".canvas canvas"),canvasUi:a(".canvas-ui"),rrValue:a(".rr-value"),dprValue:a(".dpr-value"),rrInput:a(".rr-input"),canvasSizeValue:a(".canvas-size-value"),renderPixelValue:a(".render-pixel-value"),zoomValue:a(".zoom-value"),lineStyle:{blAlign:{color:a(".bl-align-color-input"),width:a(".bl-align-width-input"),display:a(".bl-align-display-input")},fontBb:{color:a(".font-color-input"),width:a(".font-width-input"),display:a(".font-display-input")},actualBb:{color:a(".actual-color-input"),width:a(".actual-width-input"),display:a(".actual-display-input")},alphabeticBl:{display:a(".alphabetic-bl-display-input")},hangingBl:{display:a(".hanging-bl-display-input")},ideographicBl:{display:a(".ideographic-bl-display-input")}},disableDarkTheme:a(".disable-dark-theme-input"),infoModal:a(".info-modal"),infoModalSupport:a(".info-modal-support"),infoModalPermission:a(".info-modal-permission"),infoModalTexts:se(".info-modal p")};var A=[{postscriptName:"serif",fullName:"Browser serif",family:"serif",style:"(browser)"},{postscriptName:"sans-serif",fullName:"Browser sans-serif",family:"sans-serif",style:"(browser)"},{postscriptName:"monospace",fullName:"Browser monospace",family:"monospace",style:"(browser)"}],q=30,G=10,j=[{dProp:"alphabeticBl",mProp:"alphabeticBaseline"},{dProp:"ideographicBl",mProp:"ideographicBaseline"},{dProp:"hangingBl",mProp:"hangingBaseline"}];var I=e=>{let o=e.props.shared.ctx,r=o.canvas.clientWidth,n=o.canvas.clientHeight;e.props.rw=r/e.props.scaleMp,e.props.rh=n/e.props.scaleMp,o.canvas.width=r*e.props.rr,o.canvas.height=n*e.props.rr,o.scale(e.props.rr*e.props.scaleMp,e.props.rr*e.props.scaleMp),e.props.shared.cw=r,e.props.shared.ch=n},ae=e=>{let{rw:o,rh:r,shared:{ctx:n}}=e.props,g=(p,l,u)=>{n.save(),n.textAlign=e.font.align,n.textBaseline=e.font.baseline,n.font=W(e),n.fillStyle=e.props.shared.colors.text||"",n.fillText(p,l,u);let i=n.measureText(p);return n.restore(),i},b=(p,l,u)=>{let i=new Path2D;i.moveTo(0,u),i.lineTo(o,u),p===0&&(i.moveTo(l,0),i.lineTo(l,r)),n.save(),n.strokeStyle=e.props.style.blAlign.color,n.lineWidth=e.props.style.blAlign.width,n.stroke(i),n.restore()},s=(p,l,u,i)=>{let c=new Path2D;c.moveTo(0,i-l.fontBoundingBoxAscent),c.lineTo(o,i-l.fontBoundingBoxAscent),c.moveTo(0,i+l.fontBoundingBoxDescent),c.lineTo(o,i+l.fontBoundingBoxDescent),n.save(),n.strokeStyle=e.props.style.fontBb.color,n.lineWidth=e.props.style.fontBb.width,n.stroke(c),n.restore()},f=(p,l,u,i)=>{let c=new Path2D;c.moveTo(0,i-l.actualBoundingBoxAscent),c.lineTo(o,i-l.actualBoundingBoxAscent),c.moveTo(0,i+l.actualBoundingBoxDescent),c.lineTo(o,i+l.actualBoundingBoxDescent),p===0&&(c.moveTo(u-l.actualBoundingBoxLeft,0),c.lineTo(u-l.actualBoundingBoxLeft,r)),c.moveTo(u+l.actualBoundingBoxRight,0),c.lineTo(u+l.actualBoundingBoxRight,r),n.save(),n.strokeStyle=e.props.style.actualBb.color,n.lineWidth=e.props.style.actualBb.width,n.stroke(c),n.restore()},y=0,h=(p,l,u,i)=>{let c=new Path2D,T=q/e.props.scaleMp,M=G/e.props.scaleMp,V=(p===0?i-l.actualBoundingBoxAscent:y)-T,N=u+l.actualBoundingBoxRight+T;c.moveTo(u-l.actualBoundingBoxLeft,V),c.lineTo(u+l.actualBoundingBoxRight,V),c.moveTo(N,i-l.actualBoundingBoxAscent),c.lineTo(N,i+l.actualBoundingBoxDescent),n.save(),n.strokeStyle=e.props.style.actualBb.color,n.lineWidth=e.props.style.actualBb.width,n.save(),n.globalAlpha=.5,n.stroke(c),n.restore(),n.textAlign="center",n.textBaseline="bottom",n.font=W(e,e.font.size/2);let X=l.actualBoundingBoxLeft+l.actualBoundingBoxRight,ne=u-l.actualBoundingBoxLeft+X/2,O=V-M;n.save(),n.fillStyle=e.props.shared.colors.text||"",n.fillText(`${X.toFixed(1)}px`,ne,O);let $=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent,oe=N+M,le=i-l.actualBoundingBoxAscent+$/2;n.save(),n.translate(oe,le),n.rotate(90/(180/Math.PI)),n.fillText(`${$.toFixed(1)}px`,0,0),n.restore(),n.textAlign="end",n.fillText(`(${l.width.toFixed(1)}px/${l.fontBoundingBoxAscent+l.fontBoundingBoxDescent}px)`,u-M,i),n.restore(),n.restore(),y=O-e.font.size/2},w=(p,l,u,i)=>{j.forEach(({dProp:c,mProp:T})=>{if(!e.props.style[c].display)return;let M=new Path2D;M.moveTo(0,i-(l[T]||0)),M.lineTo(o,i-(l[T]||0)),n.save(),n.strokeStyle=e.props.style.blAlign.color,n.lineWidth=e.props.style.blAlign.width,n.stroke(M),n.restore()})};n.clearRect(0,0,o,r),e.text.split(`
`).forEach((p,l)=>{let u=e.props.drawX,i=e.props.drawY+e.font.lh*l,c=g(p,u,i);n.save(),n.globalAlpha=.5,e.props.style.blAlign.display&&b(l,u,i),e.props.style.fontBb.display&&s(l,c,u,i),e.props.style.actualBb.display&&f(l,c,u,i),w(l,c,u,i),n.restore(),e.props.style.actualBb.display&&h(l,c,u,i)})},R=null,d=(...e)=>{typeof R=="number"&&cancelAnimationFrame(R),R=requestAnimationFrame(ae.bind(null,...e))};var K=e=>{e.props.drawX=100,e.props.drawY=t.canvas.clientHeight-100},D=e=>{let o=t.disableDarkTheme.checked||matchMedia("(prefers-color-scheme: light)").matches,r=o?"light":"dark";t.document.classList.toggle("light",o),t.document.classList.toggle("dark",!o),e.props.shared.colors={text:C("--c-text"),bg:C("--c-bg")},e.props.style.actualBb.color=r==="light"?"#000000":"#ffffff"};var Q=({ui:e,onDown:o,onMove:r,onUp:n,onWheel:g})=>{let b=!1,s,f,y=()=>{L(),n()},h=p=>{if(p.buttons===0){y();return}p.preventDefault();let l=p.clientX-s,u=p.clientY-f;r(l,u),s=p.clientX,f=p.clientY},w=()=>{if(b){console.warn("Events are already added");return}window.addEventListener("mousemove",h),window.addEventListener("mouseup",y),b=!0},L=()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",y),b=!1};e.addEventListener("mousedown",p=>{p.preventDefault(),s=p.clientX,f=p.clientY,w(),o()}),e.addEventListener("contextmenu",p=>{p.preventDefault()}),e.addEventListener("wheel",p=>{p.preventDefault(),g(p.deltaX,p.deltaY,p)})};var J=e=>e.map(o=>{let r=document.createElement("option");return typeof o=="string"?(r.value=o,r.innerHTML=o):(r.value=o.postscriptName,r.innerHTML=o.style,r.title=o.fullName),r}),k=e=>{t.canvasSizeValue.innerHTML=e.props.rw.toFixed(1)+"x"+e.props.rh.toFixed(1),t.renderPixelValue.innerHTML=(e.props.rw*e.props.rr).toFixed(1)+"x"+(e.props.rh*e.props.rr).toFixed(1)},B=e=>{t.textInput.style.fontFamily=e.font.useFs?e.font.fs:e.font.ff,t.textInput.style.fontStyle=e.font.useItalic?"italic":"normal",t.textInput.style.fontWeight=e.font.useWeight?e.font.fw:""},Y=e=>{t.ffInput.innerHTML="",t.ffInput.append(...J(Object.keys(e.props.shared.fm))),t.ffInput.value=e.font.ff},P=(e,o=!1)=>{let r=e.props.shared.fm[e.font.ff]??x("Selected font-family is not in fontmap");t.fsInput.innerHTML="",t.fsInput.append(...J(r)),o&&(e.font.fs=r[0].postscriptName),r.map(({postscriptName:g})=>g).includes(e.font.fs)||console.warn("%o is not in available styles list. Who tf set that?",e.font.fs),t.fsInput.value=e.font.fs},z=e=>{t.textInput.value=e.text,B(e),Y(e),P(e),t.useFsInput.checked=e.font.useFs,t.fsInput.disabled=!t.useFsInput.checked,t.useItalicInput.checked=e.font.useItalic,t.useWeightInput.checked=e.font.useWeight,t.fwInput.value=e.font.fw,t.fwInput.disabled=!t.useWeightInput.checked,t.fontSizeInput.value=String(e.font.size),t.fontSizeValue.innerHTML=String(e.font.size),t.lhInput.value=String(e.font.lh),t.lhValue.innerHTML=String(e.font.lh),t.alignInput.value=e.font.align,t.baselineInput.value=e.font.baseline,t.rrValue.innerHTML=String(e.props.rr),t.dprValue.innerHTML=String(window.devicePixelRatio),t.rrInput.value=String(e.props.rr),k(e),t.zoomValue.innerHTML=String(e.props.scaleMp),t.lineStyle.blAlign.color.value=e.props.style.blAlign.color,t.lineStyle.blAlign.width.value=String(e.props.style.blAlign.width),t.lineStyle.blAlign.display.checked=e.props.style.blAlign.display,t.lineStyle.fontBb.color.value=e.props.style.fontBb.color,t.lineStyle.fontBb.width.value=String(e.props.style.fontBb.width),t.lineStyle.fontBb.display.checked=e.props.style.fontBb.display,t.lineStyle.actualBb.color.value=e.props.style.actualBb.color,t.lineStyle.actualBb.width.value=String(e.props.style.actualBb.width),t.lineStyle.actualBb.display.checked=e.props.style.actualBb.display,t.lineStyle.alphabeticBl.display.disabled=!("alphabeticBaseline"in TextMetrics.prototype),t.lineStyle.hangingBl.display.disabled=!("hangingBaseline"in TextMetrics.prototype),t.lineStyle.ideographicBl.display.disabled=!("ideographicBaseline"in TextMetrics.prototype),t.lineStyle.alphabeticBl.display.checked=e.props.style.alphabeticBl.display,t.lineStyle.ideographicBl.display.checked=e.props.style.ideographicBl.display,t.lineStyle.hangingBl.display.checked=e.props.style.hangingBl.display};var Z=e=>{t.textInput.addEventListener("input",()=>{e.text=t.textInput.value,d(e)}),t.ffInput.addEventListener("change",()=>{e.font.ff=t.ffInput.value,P(e,!0),B(e),d(e)}),t.useFsInput.addEventListener("change",()=>{e.font.useFs=t.useFsInput.checked,t.fsInput.disabled=!t.useFsInput.checked,B(e),d(e)}),t.fsInput.addEventListener("change",()=>{e.font.fs=t.fsInput.value,B(e),d(e)}),t.useItalicInput.addEventListener("change",()=>{e.font.useItalic=t.useItalicInput.checked,B(e),d(e)}),t.useWeightInput.addEventListener("change",()=>{e.font.useWeight=t.useWeightInput.checked,t.fwInput.disabled=!t.useWeightInput.checked,B(e),d(e)}),t.fwInput.addEventListener("change",()=>{e.font.fw=H(t.fwInput.value,S),B(e),d(e)}),t.localFontsButton.addEventListener("click",()=>{let s=f=>{e.props.shared.fm=F(A.concat(f)),Y(e),P(e)};window.queryLocalFonts?window.queryLocalFonts().then(f=>{f.length===0?(t.infoModalPermission.hidden=!1,t.infoModal.showModal()):s(f)}).catch(f=>{console.error("Local fonts query failed: %o",f)}):(t.infoModalSupport.hidden=!1,t.infoModal.showModal())}),t.infoModal.addEventListener("close",()=>{t.infoModalTexts.forEach(s=>s.hidden=!0)}),t.fontSizeInput.addEventListener("input",()=>{e.font.size=Number(t.fontSizeInput.value),t.fontSizeValue.innerHTML=t.fontSizeInput.value,d(e)}),t.lhInput.addEventListener("input",()=>{e.font.lh=Number(t.lhInput.value),t.lhValue.innerHTML=t.lhInput.value,d(e)}),t.alignInput.addEventListener("change",()=>{e.font.align=H(t.alignInput.value,E),d(e)}),t.baselineInput.addEventListener("change",()=>{e.font.baseline=H(t.baselineInput.value,m),d(e)}),t.rrInput.addEventListener("input",()=>{let s=t.rrInput.value;t.rrValue.innerHTML=s,e.props.rr=Number(s),I(e),k(e),d(e)}),window.addEventListener("resize",()=>{I(e),k(e),d(e)}),["blAlign","fontBb","actualBb"].forEach(s=>{t.lineStyle[s].color.addEventListener("input",()=>{e.props.style[s].color=t.lineStyle[s].color.value,d(e)}),t.lineStyle[s].width.addEventListener("input",()=>{e.props.style[s].width=Number(t.lineStyle[s].width.value),d(e)}),t.lineStyle[s].display.addEventListener("input",()=>{e.props.style[s].display=t.lineStyle[s].display.checked,d(e)})}),["alphabeticBl","hangingBl","ideographicBl"].forEach(s=>{t.lineStyle[s].display.addEventListener("input",()=>{e.props.style[s].display=t.lineStyle[s].display.checked,d(e)})});let n=0;Q({ui:t.canvasUi,onDown:()=>{t.canvasUi.classList.add("grabbing")},onMove:(s,f)=>{e.props.drawX+=s/e.props.scaleMp,e.props.drawY+=f/e.props.scaleMp,d(e)},onUp:()=>{t.canvasUi.classList.remove("grabbing")},onWheel:(s,f,y)=>{if(y.ctrlKey){n+=-f/100;let h=Math.pow(1.4,n);e.props.scaleMp=h,t.zoomValue.innerHTML=e.props.scaleMp.toFixed(2);let w=e.props.rw*(y.offsetX/e.props.shared.cw),L=e.props.rh*(y.offsetY/e.props.shared.ch);I(e);let p=e.props.rw*(y.offsetX/e.props.shared.cw),l=e.props.rh*(y.offsetY/e.props.shared.ch);e.props.drawX+=p-w,e.props.drawY+=l-L}else e.props.drawX-=s/e.props.scaleMp,e.props.drawY-=f/e.props.scaleMp;d(e)}});let g=()=>{D(e),z(e),d(e)};t.disableDarkTheme.addEventListener("change",()=>{g()});let b=s=>s.matches&&g();matchMedia("(prefers-color-scheme: dark)").onchange=s=>b(s.target),matchMedia("(prefers-color-scheme: light)").onchange=s=>b(s.target)};var ie=t.canvas.getContext("2d")??x("ctx died"),ee=F(A),te="sans-serif",re=ee[te]??x("Default font family not found"),v={text:"my honest reaction \u{1F605}\u{1F44C}\u{1F3FD}",font:{fs:re[0].postscriptName,useItalic:!1,useWeight:!1,useFs:!0,fw:"400",ff:te,size:60,lh:80,align:"start",baseline:"alphabetic"},props:{rw:0,rh:0,drawX:0,drawY:0,scaleMp:1,rr:window.devicePixelRatio,style:{blAlign:{color:"#c800c8",width:1,display:!0},fontBb:{color:"#f00000",width:1.5,display:!0},actualBb:{color:"#ffffff",width:.5,display:!0},alphabeticBl:{display:!1},hangingBl:{display:!1},ideographicBl:{display:!1}},shared:{cw:0,ch:0,fm:ee,ctx:ie,colors:{}}}},_=()=>{K(v),D(v),I(v),d(v),Z(v),z(v),U()};t.mainCss.sheet?_():t.mainCss.addEventListener("load",_);})();
//# sourceMappingURL=bundle.js.map
