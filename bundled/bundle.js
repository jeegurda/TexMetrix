"use strict";(()=>{var X=()=>{let t=["actualBoundingBoxAscent","actualBoundingBoxDescent","actualBoundingBoxLeft","actualBoundingBoxRight","fontBoundingBoxAscent","fontBoundingBoxDescent","emHeightAscent","emHeightDescent","alphabeticBaseline","hangingBaseline","ideographicBaseline","width"],s=[],i=[];t.forEach(o=>o in TextMetrics.prototype?s.push(o):i.push(o)),console.log("Supported: %o. Not supported: %o",s.join(", "),i.join(", "))};var L=(o=>(o.START="start",o.CENTER="center",o.END="end",o))(L||{}),E=(f=>(f.ALPHABETIC="alphabetic",f.BOTTOM="bottom",f.HANGING="hanging",f.IDEOGRAPHIC="ideographic",f.MIDDLE="middle",f.TOP="top",f))(E||{}),M=(c=>(c.w100="100",c.w200="200",c.w300="300",c.w400="400",c.w500="500",c.w600="600",c.w700="700",c.w800="800",c.w900="900",c))(M||{});var m=(t,s)=>{let i=Object.values(s);return i.includes(t)?t:(console.warn("%o does not exist in enum %o. Using %o",t,s,i[0]),i[0])},I=(t="Unknown",s=Error)=>{throw new s(t)},z=(t,s)=>`${t.font.useItalic?"italic":"normal"} ${t.font.useWeight?t.font.fw:""} ${s??t.font.size}px ${t.font.useFs?t.font.fs:t.font.ff}`,S=t=>{let s=t.reduce((o,{family:h,fullName:g,style:f,postscriptName:v})=>((o[h]||(o[h]=[])).push({fullName:g,style:f,postscriptName:v}),o),{});return(o=>{Object.entries(o).forEach(([h,g])=>{g?g.length===0&&console.warn("%o font record has no variants",h):console.warn("%o font record missing value",h)})})(s),s};var l=t=>document.querySelector(t)??I(`dom el missing (selector: ${t})`),e={mainCss:l(".main-css"),textInput:l(".text-input"),ffInput:l(".ff-input"),useFsInput:l(".use-fs-input"),fsInput:l(".fs-input"),useItalicInput:l(".use-italic-input"),useWeightInput:l(".use-weight-input"),fwInput:l(".fw-input"),localFontsButton:l(".local-fonts-button"),fontSizeInput:l(".font-size-input"),fontSizeValue:l(".font-size-value"),lhInput:l(".line-height-input"),lhValue:l(".line-height-value"),alignInput:l(".align-input"),baselineInput:l(".baseline-input"),canvas:l(".canvas canvas"),canvasUi:l(".canvas-ui"),rrValue:l(".rr-value"),dprValue:l(".dpr-value"),rrInput:l(".rr-input"),canvasSizeValue:l(".canvas-size-value"),renderPixelValue:l(".render-pixel-value"),zoomValue:l(".zoom-value"),lineStyle:{blAlign:{color:l(".bl-align-color-input"),width:l(".bl-align-width-input"),display:l(".bl-align-display-input")},fontBb:{color:l(".font-color-input"),width:l(".font-width-input"),display:l(".font-display-input")},actualBb:{color:l(".actual-color-input"),width:l(".actual-width-input"),display:l(".actual-display-input")}}};var F=[{postscriptName:"serif",fullName:"Browser serif",family:"serif",style:"(browser)"},{postscriptName:"sans-serif",fullName:"Browser sans-serif",family:"sans-serif",style:"(browser)"},{postscriptName:"monospace",fullName:"Browser monospace",family:"monospace",style:"(browser)"}],C=30,O=10;var x=t=>{let s=t.props.shared.ctx,i=s.canvas.clientWidth,o=s.canvas.clientHeight;t.props.rw=i/t.props.scaleMp,t.props.rh=o/t.props.scaleMp,s.canvas.width=i*t.props.rr,s.canvas.height=o*t.props.rr,s.scale(t.props.rr*t.props.scaleMp,t.props.rr*t.props.scaleMp),t.props.shared.cw=i,t.props.shared.ch=o},_=t=>{let{rw:s,rh:i,shared:{ctx:o}}=t.props,h=(d,n,r)=>{o.save(),o.textAlign=t.font.align,o.textBaseline=t.font.baseline,o.font=z(t),o.fillText(d,n,r);let a=o.measureText(d);return o.restore(),a},g=(d,n,r)=>{let a=new Path2D;a.moveTo(0,r),a.lineTo(s,r),d===0&&(a.moveTo(n,0),a.lineTo(n,i)),o.save(),o.strokeStyle=t.props.style.blAlign.color,o.lineWidth=t.props.style.blAlign.width,o.stroke(a),o.restore()},f=(d,n,r,a)=>{let p=new Path2D;p.moveTo(0,a-n.fontBoundingBoxAscent),p.lineTo(s,a-n.fontBoundingBoxAscent),p.moveTo(0,a+n.fontBoundingBoxDescent),p.lineTo(s,a+n.fontBoundingBoxDescent),o.save(),o.strokeStyle=t.props.style.fontBb.color,o.lineWidth=t.props.style.fontBb.width,o.stroke(p),o.restore()},v=(d,n,r,a)=>{let p=new Path2D;p.moveTo(0,a-n.actualBoundingBoxAscent),p.lineTo(s,a-n.actualBoundingBoxAscent),p.moveTo(0,a+n.actualBoundingBoxDescent),p.lineTo(s,a+n.actualBoundingBoxDescent),d===0&&(p.moveTo(r-n.actualBoundingBoxLeft,0),p.lineTo(r-n.actualBoundingBoxLeft,i)),p.moveTo(r+n.actualBoundingBoxRight,0),p.lineTo(r+n.actualBoundingBoxRight,i),o.save(),o.strokeStyle=t.props.style.actualBb.color,o.lineWidth=t.props.style.actualBb.width,o.stroke(p),o.restore()},w=0,c=(d,n,r,a)=>{let p=new Path2D,T=C/t.props.scaleMp,y=O/t.props.scaleMp,D=(d===0?a-n.actualBoundingBoxAscent:w)-T,k=r+n.actualBoundingBoxRight+T;p.moveTo(r-n.actualBoundingBoxLeft,D),p.lineTo(r+n.actualBoundingBoxRight,D),p.moveTo(k,a-n.actualBoundingBoxAscent),p.lineTo(k,a+n.actualBoundingBoxDescent),o.save(),o.strokeStyle=t.props.style.actualBb.color,o.lineWidth=t.props.style.actualBb.width,o.save(),o.globalAlpha=.5,o.stroke(p),o.restore(),o.textAlign="center",o.textBaseline="bottom",o.font=z(t,t.font.size/2);let Y=n.actualBoundingBoxLeft+n.actualBoundingBoxRight,J=r-n.actualBoundingBoxLeft+Y/2,W=D-y;o.fillText(`${Y.toFixed(1)}px`,J,W);let R=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent,Q=k+y,Z=a-n.actualBoundingBoxAscent+R/2;o.save(),o.translate(Q,Z),o.rotate(90/(180/Math.PI)),o.fillText(`${R.toFixed(1)}px`,0,0),o.restore(),o.textAlign="end",o.fillText(`(${n.width.toFixed(1)}px/${n.fontBoundingBoxAscent+n.fontBoundingBoxDescent}px)`,r-y,a),o.restore(),w=W-t.font.size/2};o.clearRect(0,0,s,i),t.text.split(`
`).forEach((d,n)=>{let r=t.props.drawX,a=t.props.drawY+t.font.lh*n,p=h(d,r,a);o.save(),o.globalAlpha=.5,t.props.style.blAlign.display&&g(n,r,a),t.props.style.fontBb.display&&f(n,p,r,a),t.props.style.actualBb.display&&v(n,p,r,a),o.restore(),t.props.style.actualBb.display&&c(n,p,r,a)})},N=null,u=(...t)=>{typeof N=="number"&&cancelAnimationFrame(N),N=requestAnimationFrame(_.bind(null,...t))};var U=t=>t.map(s=>{let i=document.createElement("option");return typeof s=="string"?(i.value=s,i.innerHTML=s):(i.value=s.postscriptName,i.innerHTML=s.style,i.title=s.fullName),i}),H=t=>{e.canvasSizeValue.innerHTML=t.props.rw.toFixed(1)+"x"+t.props.rh.toFixed(1),e.renderPixelValue.innerHTML=(t.props.rw*t.props.rr).toFixed(1)+"x"+(t.props.rh*t.props.rr).toFixed(1)},b=t=>{e.textInput.style.fontFamily=t.font.useFs?t.font.fs:t.font.ff,e.textInput.style.fontStyle=t.font.useItalic?"italic":"normal",e.textInput.style.fontWeight=t.font.useWeight?t.font.fw:""},P=t=>{e.ffInput.innerHTML="",e.ffInput.append(...U(Object.keys(t.props.shared.fm))),e.ffInput.value=t.font.ff},A=(t,s=!1)=>{let i=t.props.shared.fm[t.font.ff]??I("Selected font-family is not in fontmap");e.fsInput.innerHTML="",e.fsInput.append(...U(i)),s&&(t.font.fs=i[0].postscriptName),i.map(({postscriptName:h})=>h).includes(t.font.fs)||console.warn("%o is not in available styles list. Who tf set that?",t.font.fs),e.fsInput.value=t.font.fs},$=t=>{e.textInput.value=t.text,b(t),P(t),A(t),e.useFsInput.checked=t.font.useFs,e.fsInput.disabled=!e.useFsInput.checked,e.useItalicInput.checked=t.font.useItalic,e.useWeightInput.checked=t.font.useWeight,e.fwInput.value=t.font.fw,e.fwInput.disabled=!e.useWeightInput.checked,e.fontSizeInput.value=String(t.font.size),e.fontSizeValue.innerHTML=String(t.font.size),e.lhInput.value=String(t.font.lh),e.lhValue.innerHTML=String(t.font.lh),e.alignInput.value=t.font.align,e.baselineInput.value=t.font.baseline,e.rrValue.innerHTML=String(t.props.rr),e.dprValue.innerHTML=String(window.devicePixelRatio),e.rrInput.value=String(t.props.rr),H(t),e.zoomValue.innerHTML=String(t.props.scaleMp),e.lineStyle.blAlign.color.value=t.props.style.blAlign.color,e.lineStyle.blAlign.width.value=String(t.props.style.blAlign.width),e.lineStyle.blAlign.display.checked=t.props.style.blAlign.display,e.lineStyle.fontBb.color.value=t.props.style.fontBb.color,e.lineStyle.fontBb.width.value=String(t.props.style.fontBb.width),e.lineStyle.fontBb.display.checked=t.props.style.fontBb.display,e.lineStyle.actualBb.color.value=t.props.style.actualBb.color,e.lineStyle.actualBb.width.value=String(t.props.style.actualBb.width),e.lineStyle.actualBb.display.checked=t.props.style.actualBb.display};var q=t=>{e.textInput.addEventListener("input",()=>{t.text=e.textInput.value,u(t)}),e.ffInput.addEventListener("change",()=>{t.font.ff=e.ffInput.value,A(t,!0),b(t),u(t)}),e.useFsInput.addEventListener("change",()=>{t.font.useFs=e.useFsInput.checked,e.fsInput.disabled=!e.useFsInput.checked,b(t),u(t)}),e.fsInput.addEventListener("change",()=>{t.font.fs=e.fsInput.value,b(t),u(t)}),e.useItalicInput.addEventListener("change",()=>{t.font.useItalic=e.useItalicInput.checked,b(t),u(t)}),e.useWeightInput.addEventListener("change",()=>{t.font.useWeight=e.useWeightInput.checked,e.fwInput.disabled=!e.useWeightInput.checked,b(t),u(t)}),e.fwInput.addEventListener("change",()=>{t.font.fw=m(e.fwInput.value,M),b(t),u(t)}),e.localFontsButton.addEventListener("click",()=>{let n=r=>{t.props.shared.fm=S(F.concat(r)),P(t),A(t)};window.queryLocalFonts?window.queryLocalFonts().then(r=>{r.length===0?console.warn("Empty array, permission denied. Enable manually in browser"):n(r)}).catch(r=>{console.error("Local fonts query failed: %o",r)}):console.warn("Local fonts not supported")}),e.fontSizeInput.addEventListener("input",()=>{t.font.size=Number(e.fontSizeInput.value),e.fontSizeValue.innerHTML=e.fontSizeInput.value,u(t)}),e.lhInput.addEventListener("input",()=>{t.font.lh=Number(e.lhInput.value),e.lhValue.innerHTML=e.lhInput.value,u(t)}),e.alignInput.addEventListener("change",()=>{t.font.align=m(e.alignInput.value,L),u(t)}),e.baselineInput.addEventListener("change",()=>{t.font.baseline=m(e.baselineInput.value,E),u(t)}),e.rrInput.addEventListener("input",()=>{let n=e.rrInput.value;e.rrValue.innerHTML=n,t.props.rr=Number(n),x(t),H(t),u(t)}),window.addEventListener("resize",()=>{x(t),H(t),u(t)}),["blAlign","fontBb","actualBb"].forEach(n=>{e.lineStyle[n].color.addEventListener("input",()=>{t.props.style[n].color=e.lineStyle[n].color.value,u(t)}),e.lineStyle[n].width.addEventListener("input",()=>{t.props.style[n].width=Number(e.lineStyle[n].width.value),u(t)}),e.lineStyle[n].display.addEventListener("input",()=>{t.props.style[n].display=e.lineStyle[n].display.checked,u(t)})}),e.canvasUi.addEventListener("contextmenu",n=>{n.preventDefault()});let i=0;e.canvasUi.addEventListener("wheel",n=>{if(n.preventDefault(),n.ctrlKey){i+=-n.deltaY/100;let r=Math.pow(1.4,i);t.props.scaleMp=r,e.zoomValue.innerHTML=t.props.scaleMp.toFixed(2);let a=t.props.rw*(n.offsetX/t.props.shared.cw),p=t.props.rh*(n.offsetY/t.props.shared.ch);x(t);let T=t.props.rw*(n.offsetX/t.props.shared.cw),y=t.props.rh*(n.offsetY/t.props.shared.ch);t.props.drawX+=T-a,t.props.drawY+=y-p}else{let r=n.deltaX/t.props.scaleMp,a=n.deltaY/t.props.scaleMp;t.props.drawX-=r,t.props.drawY-=a}u(t)});let o=!1,h,g,f,v,w=()=>{e.canvasUi.classList.remove("grabbing"),d()},c=n=>{if(n.buttons===0){w();return}n.preventDefault(),t.props.drawX=f+(n.clientX-h)/t.props.scaleMp,t.props.drawY=v+(n.clientY-g)/t.props.scaleMp,u(t)},V=()=>{if(o){console.warn("Events already exist");return}window.addEventListener("mousemove",c),window.addEventListener("mouseup",w),o=!0},d=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",w),o=!1};e.canvasUi.addEventListener("mousedown",n=>{n.preventDefault(),e.canvasUi.classList.add("grabbing"),h=n.clientX,g=n.clientY,f=t.props.drawX,v=t.props.drawY,V()})};var tt=e.canvas.getContext("2d")??I("ctx died"),G=S(F),K="sans-serif",et=G[K]??I("Default font family not found"),B={text:"my honest reaction \u{1F605}\u{1F44C}\u{1F3FD}",font:{fs:et[0].postscriptName,useItalic:!1,useWeight:!1,useFs:!0,fw:"400",ff:K,size:60,lh:80,align:"start",baseline:"alphabetic"},props:{rw:0,rh:0,drawX:0,drawY:0,scaleMp:1,rr:window.devicePixelRatio,style:{blAlign:{color:"#c800c8",width:.5,display:!0},fontBb:{color:"#f00000",width:.5,display:!0},actualBb:{color:"#000000",width:.5,display:!0}},shared:{cw:0,ch:0,fm:G,ctx:tt}}},nt=()=>{B.props.drawX=100,B.props.drawY=e.canvas.clientHeight-100},j=()=>{nt(),x(B),u(B),q(B),$(B)};X();e.mainCss.sheet?j():e.mainCss.addEventListener("load",j);})();
//# sourceMappingURL=bundle.js.map
