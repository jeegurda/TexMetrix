"use strict";(()=>{var X=()=>{let t=["actualBoundingBoxAscent","actualBoundingBoxDescent","actualBoundingBoxLeft","actualBoundingBoxRight","fontBoundingBoxAscent","fontBoundingBoxDescent","emHeightAscent","emHeightDescent","alphabeticBaseline","hangingBaseline","ideographicBaseline","width"],r=[],i=[];t.forEach(n=>n in TextMetrics.prototype?r.push(n):i.push(n)),console.log("Supported: %o. Not supported: %o",r.join(", "),i.join(", "))};var v=(n=>(n.START="start",n.CENTER="center",n.END="end",n))(v||{}),L=(g=>(g.ALPHABETIC="alphabetic",g.BOTTOM="bottom",g.HANGING="hanging",g.IDEOGRAPHIC="ideographic",g.MIDDLE="middle",g.TOP="top",g))(L||{}),T=(i=>(i.NORMAL="Normal",i.ITALIC="Italic",i))(T||{}),I=(i=>(i.REGULAR="Regular",i.BOLD="Bold",i))(I||{});var b=(t,r)=>{let i=Object.values(r);return i.includes(t)?t:(console.warn("%o does not exist in enum %o. Using %o",t,r,i[0]),i[0])},h=(t="Unknown",r=Error)=>{throw new r(t)},D=(t,r,i,n)=>{switch(n){case"Normal":case"Italic":n=n.toLowerCase();break;default:console.warn("Unknown fs: %o. Using normal",i),n="normal"}switch(i){case"Regular":i="normal";break;case"Bold":i=i.toLowerCase();break;default:console.warn("Unknown fw: %o. Using normal",i),i="normal"}return`${n} ${i} ${t}px ${r}`},B=t=>{let r=t.reduce((n,f)=>{let c=n[f.family]||(n[f.family]={fs:["Normal"],fw:[]});switch(f.style){case"Italic":c.fs??(c.fs=[]),c.fs.push("Italic");break;case"Bold":c.fw??(c.fw=[]),c.fw.push("Bold");break;case"Regular":c.fw??(c.fw=[]),c.fw.push("Regular");break;default:console.warn('Unknown "style" for setting font-style: %o',f.style)}return n},{}),i=n=>{Object.entries(n).forEach(([f,c])=>{c?c.fw.length===1&&console.warn("%o font record has only 1 weight"):console.warn("%o font record missing value")})};return r};var s=t=>document.querySelector(t)??h(`dom el missing (selector: ${t})`),e={textInput:s(".text-input"),ffInput:s(".font-family-input"),fwInput:s(".font-weight-input"),fsInput:s(".font-style-input"),localFontsButton:s(".local-fonts-button"),fontSizeInput:s(".font-size-input"),fontSizeValue:s(".font-size-value"),lhInput:s(".line-height-input"),lhValue:s(".line-height-value"),alignInput:s(".align-input"),baselineInput:s(".baseline-input"),canvas:s(".canvas canvas"),canvasUi:s(".canvas-ui"),rrValue:s(".rr-value"),dprValue:s(".dpr-value"),rrInput:s(".rr-input"),canvasSizeValue:s(".canvas-size-value"),renderPixelValue:s(".render-pixel-value"),zoomValue:s(".zoom-value"),lineStyle:{blAlign:{color:s(".bl-align-color-input"),width:s(".bl-align-width-input"),display:s(".bl-align-display-input")},fontBb:{color:s(".font-color-input"),width:s(".font-width-input"),display:s(".font-display-input")},actualBb:{color:s(".actual-color-input"),width:s(".actual-width-input"),display:s(".actual-display-input")}}};var E=[{family:"serif",style:"Regular"},{family:"serif",style:"Bold"},{family:"serif",style:"Italic"},{family:"sans-serif",style:"Regular"},{family:"sans-serif",style:"Bold"},{family:"sans-serif",style:"Italic"},{family:"monospace",style:"Regular"},{family:"monospace",style:"Bold"},{family:"monospace",style:"Italic"}],S=[];var F=t=>{e.canvasSizeValue.innerHTML=t.props.rw.toFixed(1)+"x"+t.props.rh.toFixed(1),e.renderPixelValue.innerHTML=(t.props.rw*t.props.rr).toFixed(1)+"x"+(t.props.rh*t.props.rr).toFixed(1)},x=t=>{e.textInput.style.fontFamily=t.font.ff,e.textInput.style.fontStyle=t.font.fs,e.textInput.style.fontWeight=t.font.fw},N=t=>{let r=g=>g.map(y=>{let w=document.createElement("option");return w.value=y,w.innerHTML=y,w}),i=B(E),n=B(S),f={...i,...n};e.ffInput.innerHTML="",e.ffInput.append(...r(Object.keys(f))),e.ffInput.value=t.font.ff;let c=f[t.font.ff]??h("Selected font-family is not in array");e.fwInput.innerHTML="",e.fwInput.append(...r(c.fw)),e.fwInput.value=t.font.fw,e.fsInput.innerHTML="",e.fsInput.append(...r(c.fs)),e.fsInput.value=t.font.fs},C=t=>{e.textInput.value=t.text,x(t),N(t),e.fontSizeInput.value=String(t.font.size),e.fontSizeValue.innerHTML=String(t.font.size),e.lhInput.value=String(t.font.lh),e.lhValue.innerHTML=String(t.font.lh),e.alignInput.value=t.font.align,e.baselineInput.value=t.font.baseline,e.rrValue.innerHTML=String(t.props.rr),e.dprValue.innerHTML=String(window.devicePixelRatio),e.rrInput.value=String(t.props.rr),F(t),e.zoomValue.innerHTML=String(t.props.scaleMp),e.lineStyle.blAlign.color.value=t.props.style.blAlign.color,e.lineStyle.blAlign.width.value=String(t.props.style.blAlign.width),e.lineStyle.blAlign.display.checked=t.props.style.blAlign.display,e.lineStyle.fontBb.color.value=t.props.style.fontBb.color,e.lineStyle.fontBb.width.value=String(t.props.style.fontBb.width),e.lineStyle.fontBb.display.checked=t.props.style.fontBb.display,e.lineStyle.actualBb.color.value=t.props.style.actualBb.color,e.lineStyle.actualBb.width.value=String(t.props.style.actualBb.width),e.lineStyle.actualBb.display.checked=t.props.style.actualBb.display},M=(t,r)=>{S.splice(0,S.length,...r),N(t)};var $=t=>{e.textInput.addEventListener("input",()=>{t.text=e.textInput.value,t.draw()}),e.ffInput.addEventListener("change",()=>{t.font.ff=e.ffInput.value,x(t),t.draw()}),e.fwInput.addEventListener("change",()=>{t.font.fw=b(e.fwInput.value,I),x(t),t.draw()}),e.fsInput.addEventListener("change",()=>{t.font.fs=b(e.fsInput.value,T),x(t),t.draw()}),e.localFontsButton.addEventListener("click",async()=>{window.queryLocalFonts?window.queryLocalFonts().then(n=>{n.length===0?console.warn("Empty array, permission denied. Enable manually in browser"):M(t,n)}).catch(n=>{console.error("Local fonts query failed: %o",n)}):console.warn("Local fonts not supported")}),e.fontSizeInput.addEventListener("input",()=>{t.font.size=Number(e.fontSizeInput.value),e.fontSizeValue.innerHTML=e.fontSizeInput.value,t.draw()}),e.lhInput.addEventListener("input",()=>{t.font.lh=Number(e.lhInput.value),e.lhValue.innerHTML=e.lhInput.value,t.draw()}),e.alignInput.addEventListener("change",()=>{t.font.align=b(e.alignInput.value,v),t.draw()}),e.baselineInput.addEventListener("change",()=>{t.font.baseline=b(e.baselineInput.value,L),t.draw()}),e.rrInput.addEventListener("input",()=>{let n=e.rrInput.value;e.rrValue.innerHTML=n,t.props.rr=Number(n),t.init(),F(t),t.draw()}),window.addEventListener("resize",()=>{t.init(),F(t),t.draw()}),e.canvasUi.addEventListener("contextmenu",n=>{n.preventDefault()});let r=0;e.canvasUi.addEventListener("wheel",n=>{if(n.preventDefault(),n.ctrlKey){r+=-n.deltaY/100;let f=t.props.scaleMp,c=Math.pow(1.4,r);t.props.scaleMp=c,e.zoomValue.innerHTML=t.props.scaleMp.toFixed(2),f-=t.props.scaleMp;let g=t.props.rw*(n.offsetX/t.props.shared.cw),y=t.props.rh*(n.offsetY/t.props.shared.ch);t.init();let w=t.props.rw*(n.offsetX/t.props.shared.cw),m=t.props.rh*(n.offsetY/t.props.shared.ch);t.props.drawX+=w-g,t.props.drawY+=m-y}else{let f=n.deltaX/t.props.scaleMp,c=n.deltaY/t.props.scaleMp;t.props.drawX-=f,t.props.drawY-=c}t.draw()}),e.canvasUi.addEventListener("mousedown",n=>{n.preventDefault(),e.canvasUi.classList.add("grabbing");let f=n.clientX,c=n.clientY,g=t.props.drawX,y=t.props.drawY,w=l=>{l.preventDefault(),t.props.drawX=g+(l.clientX-f)/t.props.scaleMp,t.props.drawY=y+(l.clientY-c)/t.props.scaleMp,t.draw()},m=()=>{e.canvasUi.classList.remove("grabbing"),window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",m)};window.addEventListener("mousemove",w),window.addEventListener("mouseup",m)}),["blAlign","fontBb","actualBb"].forEach(n=>{e.lineStyle[n].color.addEventListener("input",()=>{t.props.style[n].color=e.lineStyle[n].color.value,t.draw()}),e.lineStyle[n].width.addEventListener("input",()=>{t.props.style[n].width=Number(e.lineStyle[n].width.value),t.draw()}),e.lineStyle[n].display.addEventListener("input",()=>{t.props.style[n].display=e.lineStyle[n].display.checked,t.draw()})})};var J=30,Q=10,a=e.canvas.getContext("2d")??h("ctx died"),W="sans-serif",q=B(E)[W]??h("Builtin font family not found"),o={text:"my honest reaction \u{1F605}\u{1F44C}\u{1F3FD}",font:{fs:q.fs[0],fw:q.fw[0],ff:W,size:60,lh:80,align:"start",baseline:"alphabetic"},props:{rw:0,rh:0,drawX:100,drawY:e.canvas.clientHeight-100,scaleMp:1,rr:window.devicePixelRatio,style:{blAlign:{color:"#c800c8",width:.5,display:!0},fontBb:{color:"#f00000",width:.5,display:!0},actualBb:{color:"#000000",width:.5,display:!0}},shared:{cw:0,ch:0}},draw:()=>{},init:()=>{}},G=()=>{let t=a.canvas.clientWidth,r=a.canvas.clientHeight;o.props.rw=t/o.props.scaleMp,o.props.rh=r/o.props.scaleMp,a.canvas.width=t*o.props.rr,a.canvas.height=r*o.props.rr,a.scale(o.props.rr*o.props.scaleMp,o.props.rr*o.props.scaleMp),o.props.shared.cw=t,o.props.shared.ch=r},k=null,j=()=>{typeof k=="number"&&cancelAnimationFrame(k),k=requestAnimationFrame(Z)},Z=()=>{let{rw:t,rh:r}=o.props,i=(m,l,d)=>{a.textAlign=o.font.align,a.textBaseline=o.font.baseline,a.font=D(o.font.size,o.font.ff,o.font.fw,o.font.fs),a.fillText(m,l,d)},n=(m,l,d)=>{let p=new Path2D;p.moveTo(0,d),p.lineTo(t,d),m===0&&(p.moveTo(l,0),p.lineTo(l,r)),a.strokeStyle=o.props.style.blAlign.color,a.lineWidth=o.props.style.blAlign.width,a.stroke(p)},f=(m,l,d,p)=>{let u=new Path2D;u.moveTo(0,p-l.fontBoundingBoxAscent),u.lineTo(t,p-l.fontBoundingBoxAscent),u.moveTo(0,p+l.fontBoundingBoxDescent),u.lineTo(t,p+l.fontBoundingBoxDescent),a.strokeStyle=o.props.style.fontBb.color,a.lineWidth=o.props.style.fontBb.width,a.stroke(u)},c=(m,l,d,p)=>{let u=new Path2D;u.moveTo(0,p-l.actualBoundingBoxAscent),u.lineTo(t,p-l.actualBoundingBoxAscent),u.moveTo(0,p+l.actualBoundingBoxDescent),u.lineTo(t,p+l.actualBoundingBoxDescent),m===0&&(u.moveTo(d-l.actualBoundingBoxLeft,0),u.lineTo(d-l.actualBoundingBoxLeft,r)),u.moveTo(d+l.actualBoundingBoxRight,0),u.lineTo(d+l.actualBoundingBoxRight,r),a.strokeStyle=o.props.style.actualBb.color,a.lineWidth=o.props.style.actualBb.width,a.stroke(u)},g=0,y=(m,l,d,p)=>{let u=new Path2D,R=J/o.props.scaleMp,z=Q/o.props.scaleMp,A=(m===0?p-l.actualBoundingBoxAscent:g)-R,H=d+l.actualBoundingBoxRight+R;u.moveTo(d-l.actualBoundingBoxLeft,A),u.lineTo(d+l.actualBoundingBoxRight,A),u.moveTo(H,p-l.actualBoundingBoxAscent),u.lineTo(H,p+l.actualBoundingBoxDescent),a.globalAlpha=.5,a.strokeStyle=o.props.style.actualBb.color,a.lineWidth=o.props.style.actualBb.width,a.stroke(u),a.globalAlpha=1,a.textAlign="center",a.textBaseline="bottom",a.font=D(o.font.size/2,o.font.ff,o.font.fw,o.font.fs);let P=l.actualBoundingBoxLeft+l.actualBoundingBoxRight,K=d-l.actualBoundingBoxLeft+P/2,V=A-z;a.fillText(`${P.toFixed(1)}px`,K,V);let Y=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent,O=H+z,U=p-l.actualBoundingBoxAscent+Y/2;a.translate(O,U),a.rotate(90/(180/Math.PI)),a.fillText(`${Y.toFixed(1)}px`,0,0),a.rotate(-90/(180/Math.PI)),a.translate(-O,-U),g=V-o.font.size/2};a.clearRect(0,0,t,r),o.text.split(`
`).forEach((m,l)=>{let d=o.props.drawX,p=o.props.drawY+o.font.lh*l;i(m,d,p),a.globalAlpha=.5;let u=a.measureText(m);o.props.style.blAlign.display&&n(l,d,p),o.props.style.fontBb.display&&f(l,u,d,p),o.props.style.actualBb.display&&c(l,u,d,p),a.globalAlpha=1,o.props.style.actualBb.display&&y(l,u,d,p)})};o.draw=j;o.init=G;$(o);G();j();C(o);X();})();
//# sourceMappingURL=bundle.js.map
